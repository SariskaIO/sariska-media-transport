!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SariskaMediaTransport=t():e.SariskaMediaTransport=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}([function(e,t,n){"use strict";var i=n(14),r=Object.getPrototypeOf,o=i.a.slice,s=i.a.flat?function(e){return i.a.flat.call(e)}:function(e){return i.a.concat.apply([],e)},a=n(16),c=n(22),u=n(21),d=n(31),h=u.a.hasOwnProperty,l=h.toString,p=l.call(Object);var f=n(11),m={type:!0,src:!0,nonce:!0,noModule:!0};var _=function(e,t,n){var i,r=(n=n||f.a).createElement("script");if(r.text=e,t)for(i in m)t[i]&&(r[i]=t[i]);n.head.appendChild(r).parentNode.removeChild(r)},g=n(32),E=/HTML$/i,v=function(e,t){return new v.fn.init(e,t)};function S(e){var t=!!e&&e.length,n=Object(g.a)(e);return"function"!=typeof e&&!function(e){return null!=e&&e===e.window}(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}v.fn=v.prototype={jquery:"@VERSION",constructor:v,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=v.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return v.each(this,e)},map:function(e){return this.pushStack(v.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(v.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(v.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()}},v.extend=v.fn.extend=function(){var e,t,n,i,r,o,s=arguments[0]||{},a=1,c=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[a]||{},a++),"object"!=typeof s&&"function"!=typeof s&&(s={}),a===c&&(s=this,a--);a<c;a++)if(null!=(e=arguments[a]))for(t in e)i=e[t],"__proto__"!==t&&s!==i&&(u&&i&&(v.isPlainObject(i)||(r=Array.isArray(i)))?(n=s[t],o=r&&!Array.isArray(n)?[]:r||v.isPlainObject(n)?n:{},r=!1,s[t]=v.extend(u,o,i)):void 0!==i&&(s[t]=i));return s},v.extend({expando:"jQuery"+("@VERSION"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==d.a.call(e))&&(!(t=r(e))||"function"==typeof(n=h.call(t,"constructor")&&t.constructor)&&l.call(n)===p)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){_(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,i=0;if(S(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},text:function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r)return e.textContent;if(3===r||4===r)return e.nodeValue}else for(;t=e[i++];)n+=v.text(t);return n},makeArray:function(e,t){var n=t||[];return null!=e&&(S(Object(e))?v.merge(n,"string"==typeof e?[e]:e):a.a.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:c.a.call(t,e,n)},isXMLDoc:function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!E.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;i<n;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i=[],r=0,o=e.length,s=!n;r<o;r++)!t(e[r],r)!==s&&i.push(e[r]);return i},map:function(e,t,n){var i,r,o=0,a=[];if(S(e))for(i=e.length;o<i;o++)null!=(r=t(e[o],o,n))&&a.push(r);else for(o in e)null!=(r=t(e[o],o,n))&&a.push(r);return s(a)},guid:1,support:{}}),"function"==typeof Symbol&&(v.fn[Symbol.iterator]=i.a[Symbol.iterator]),v.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){u.a["[object "+t+"]"]=t.toLowerCase()}));t.a=v},function(e,t,n){"use strict";n.r(t),n.d(t,"AUDIO_INPUT_STATE_CHANGE",(function(){return i})),n.d(t,"AUTH_STATUS_CHANGED",(function(){return r})),n.d(t,"BEFORE_STATISTICS_DISPOSED",(function(){return o})),n.d(t,"CONFERENCE_ERROR",(function(){return s})),n.d(t,"CONFERENCE_FAILED",(function(){return a})),n.d(t,"CONFERENCE_JOINED",(function(){return c})),n.d(t,"CONFERENCE_LEFT",(function(){return u})),n.d(t,"CONFERENCE_UNIQUE_ID_SET",(function(){return d})),n.d(t,"CONNECTION_ESTABLISHED",(function(){return h})),n.d(t,"CONNECTION_INTERRUPTED",(function(){return l})),n.d(t,"CONNECTION_RESTORED",(function(){return p})),n.d(t,"DATA_CHANNEL_OPENED",(function(){return f})),n.d(t,"DISPLAY_NAME_CHANGED",(function(){return m})),n.d(t,"DOMINANT_SPEAKER_CHANGED",(function(){return _})),n.d(t,"CONFERENCE_CREATED_TIMESTAMP",(function(){return g})),n.d(t,"DTMF_SUPPORT_CHANGED",(function(){return E})),n.d(t,"ENDPOINT_MESSAGE_RECEIVED",(function(){return v})),n.d(t,"ENDPOINT_STATS_RECEIVED",(function(){return S})),n.d(t,"JVB121_STATUS",(function(){return y})),n.d(t,"KICKED",(function(){return T})),n.d(t,"PARTICIPANT_KICKED",(function(){return b})),n.d(t,"LAST_N_ENDPOINTS_CHANGED",(function(){return C})),n.d(t,"LOCK_STATE_CHANGED",(function(){return A})),n.d(t,"SERVER_REGION_CHANGED",(function(){return N})),n.d(t,"_MEDIA_SESSION_STARTED",(function(){return O})),n.d(t,"_MEDIA_SESSION_ACTIVE_CHANGED",(function(){return I})),n.d(t,"MEMBERS_ONLY_CHANGED",(function(){return R})),n.d(t,"MESSAGE_RECEIVED",(function(){return D})),n.d(t,"NO_AUDIO_INPUT",(function(){return P})),n.d(t,"NOISY_MIC",(function(){return L})),n.d(t,"PRIVATE_MESSAGE_RECEIVED",(function(){return w})),n.d(t,"PARTICIPANT_CONN_STATUS_CHANGED",(function(){return M})),n.d(t,"PARTCIPANT_FEATURES_CHANGED",(function(){return x})),n.d(t,"PARTICIPANT_PROPERTY_CHANGED",(function(){return F})),n.d(t,"P2P_STATUS",(function(){return j})),n.d(t,"PHONE_NUMBER_CHANGED",(function(){return k})),n.d(t,"PROPERTIES_CHANGED",(function(){return H})),n.d(t,"RECORDER_STATE_CHANGED",(function(){return U})),n.d(t,"VIDEO_SIP_GW_AVAILABILITY_CHANGED",(function(){return J})),n.d(t,"VIDEO_SIP_GW_SESSION_STATE_CHANGED",(function(){return B})),n.d(t,"START_MUTED_POLICY_CHANGED",(function(){return V})),n.d(t,"STARTED_MUTED",(function(){return G})),n.d(t,"SUBJECT_CHANGED",(function(){return q})),n.d(t,"SUSPEND_DETECTED",(function(){return $})),n.d(t,"TALK_WHILE_MUTED",(function(){return W})),n.d(t,"TRACK_ADDED",(function(){return K})),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",(function(){return X})),n.d(t,"TRACK_MUTE_CHANGED",(function(){return z})),n.d(t,"TRACK_REMOVED",(function(){return Y})),n.d(t,"TRANSCRIPTION_STATUS_CHANGED",(function(){return Q})),n.d(t,"USER_JOINED",(function(){return Z})),n.d(t,"USER_LEFT",(function(){return ee})),n.d(t,"USER_ROLE_CHANGED",(function(){return te})),n.d(t,"USER_STATUS_CHANGED",(function(){return ne})),n.d(t,"BOT_TYPE_CHANGED",(function(){return ie})),n.d(t,"LOBBY_USER_JOINED",(function(){return re})),n.d(t,"LOBBY_USER_UPDATED",(function(){return oe})),n.d(t,"LOBBY_USER_LEFT",(function(){return se}));const i="conference.audio_input_state_changed",r="conference.auth_status_changed",o="conference.beforeStatisticsDisposed",s="conference.error",a="conference.failed",c="conference.joined",u="conference.left",d="conference.unique_id_set",h="conference.connectionEstablished",l="conference.connectionInterrupted",p="conference.connectionRestored",f="conference.dataChannelOpened",m="conference.displayNameChanged",_="conference.dominantSpeaker",g="conference.createdTimestamp",E="conference.dtmfSupportChanged",v="conference.endpoint_message_received",S="conference.endpoint_stats_received",y="conference.jvb121Status",T="conference.kicked",b="conference.participant_kicked",C="conference.lastNEndpointsChanged",A="conference.lock_state_changed",N="conference.server_region_changed",O="conference.media_session.started",I="conference.media_session.active_changed",R="conference.membersOnlyChanged",D="conference.messageReceived",P="conference.no_audio_input",L="conference.noisy_mic",w="conference.privateMessageReceived",M="conference.participant_conn_status_changed",x="conference.partcipant_features_changed",F="conference.participant_property_changed",j="conference.p2pStatus",k="conference.phoneNumberChanged",H="conference.propertiesChanged",U="conference.recorderStateChanged",J="conference.videoSIPGWAvailabilityChanged",B="conference.videoSIPGWSessionStateChanged",V="conference.start_muted_policy_changed",G="conference.started_muted",q="conference.subjectChanged",$="conference.suspendDetected",W="conference.talk_while_muted",K="conference.trackAdded",X="conference.audioLevelsChanged",z="conference.trackMuteChanged",Y="conference.trackRemoved",Q="conference.transcriptionStatusChanged",Z="conference.userJoined",ee="conference.userLeft",te="conference.roleChanged",ne="conference.statusChanged",ie="conference.bot_type_changed",re="conference.lobby.userJoined",oe="conference.lobby.userUpdated",se="conference.lobby.userLeft"},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){(function(t){var n;n=function(){"use strict";var e=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var r=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},o=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},s=function(e,t,n,i,o,s){return r((a=r(r(t,e),r(i,s)))<<(c=o)|a>>>32-c,n);var a,c},a=function(e,t,n,i,r,o,a){return s(t&n|~t&i,e,t,r,o,a)},c=function(e,t,n,i,r,o,a){return s(t&i|n&~i,e,t,r,o,a)},u=function(e,t,n,i,r,o,a){return s(t^n^i,e,t,r,o,a)},d=function(e,t,n,i,r,o,a){return s(n^(t|~i),e,t,r,o,a)},h=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,i,o,s,h=1732584193,l=-271733879,p=-1732584194,f=271733878,m=0;m<e.length;m+=16)n=h,i=l,o=p,s=f,h=a(h,l,p,f,e[m+0],7,-680876936),f=a(f,h,l,p,e[m+1],12,-389564586),p=a(p,f,h,l,e[m+2],17,606105819),l=a(l,p,f,h,e[m+3],22,-1044525330),h=a(h,l,p,f,e[m+4],7,-176418897),f=a(f,h,l,p,e[m+5],12,1200080426),p=a(p,f,h,l,e[m+6],17,-1473231341),l=a(l,p,f,h,e[m+7],22,-45705983),h=a(h,l,p,f,e[m+8],7,1770035416),f=a(f,h,l,p,e[m+9],12,-1958414417),p=a(p,f,h,l,e[m+10],17,-42063),l=a(l,p,f,h,e[m+11],22,-1990404162),h=a(h,l,p,f,e[m+12],7,1804603682),f=a(f,h,l,p,e[m+13],12,-40341101),p=a(p,f,h,l,e[m+14],17,-1502002290),l=a(l,p,f,h,e[m+15],22,1236535329),h=c(h,l,p,f,e[m+1],5,-165796510),f=c(f,h,l,p,e[m+6],9,-1069501632),p=c(p,f,h,l,e[m+11],14,643717713),l=c(l,p,f,h,e[m+0],20,-373897302),h=c(h,l,p,f,e[m+5],5,-701558691),f=c(f,h,l,p,e[m+10],9,38016083),p=c(p,f,h,l,e[m+15],14,-660478335),l=c(l,p,f,h,e[m+4],20,-405537848),h=c(h,l,p,f,e[m+9],5,568446438),f=c(f,h,l,p,e[m+14],9,-1019803690),p=c(p,f,h,l,e[m+3],14,-187363961),l=c(l,p,f,h,e[m+8],20,1163531501),h=c(h,l,p,f,e[m+13],5,-1444681467),f=c(f,h,l,p,e[m+2],9,-51403784),p=c(p,f,h,l,e[m+7],14,1735328473),l=c(l,p,f,h,e[m+12],20,-1926607734),h=u(h,l,p,f,e[m+5],4,-378558),f=u(f,h,l,p,e[m+8],11,-2022574463),p=u(p,f,h,l,e[m+11],16,1839030562),l=u(l,p,f,h,e[m+14],23,-35309556),h=u(h,l,p,f,e[m+1],4,-1530992060),f=u(f,h,l,p,e[m+4],11,1272893353),p=u(p,f,h,l,e[m+7],16,-155497632),l=u(l,p,f,h,e[m+10],23,-1094730640),h=u(h,l,p,f,e[m+13],4,681279174),f=u(f,h,l,p,e[m+0],11,-358537222),p=u(p,f,h,l,e[m+3],16,-722521979),l=u(l,p,f,h,e[m+6],23,76029189),h=u(h,l,p,f,e[m+9],4,-640364487),f=u(f,h,l,p,e[m+12],11,-421815835),p=u(p,f,h,l,e[m+15],16,530742520),l=u(l,p,f,h,e[m+2],23,-995338651),h=d(h,l,p,f,e[m+0],6,-198630844),f=d(f,h,l,p,e[m+7],10,1126891415),p=d(p,f,h,l,e[m+14],15,-1416354905),l=d(l,p,f,h,e[m+5],21,-57434055),h=d(h,l,p,f,e[m+12],6,1700485571),f=d(f,h,l,p,e[m+3],10,-1894986606),p=d(p,f,h,l,e[m+10],15,-1051523),l=d(l,p,f,h,e[m+1],21,-2054922799),h=d(h,l,p,f,e[m+8],6,1873313359),f=d(f,h,l,p,e[m+15],10,-30611744),p=d(p,f,h,l,e[m+6],15,-1560198380),l=d(l,p,f,h,e[m+13],21,1309151649),h=d(h,l,p,f,e[m+4],6,-145523070),f=d(f,h,l,p,e[m+11],10,-1120210379),p=d(p,f,h,l,e[m+2],15,718787259),l=d(l,p,f,h,e[m+9],21,-343485551),h=r(h,n),l=r(l,i),p=r(p,o),f=r(f,s);return[h,l,p,f]},l={hexdigest:function(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(h(o(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(h(o(e),8*e.length))}};function p(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,i,r,o,s,a,c,u,d=new Array(80),h=1732584193,l=-271733879,p=-1732584194,_=271733878,v=-1009589776;for(n=0;n<e.length;n+=16){for(o=h,s=l,a=p,c=_,u=v,i=0;i<80;i++)d[i]=i<16?e[n+i]:E(d[i-3]^d[i-8]^d[i-14]^d[i-16],1),r=g(g(E(h,5),f(i,l,p,_)),g(g(v,d[i]),m(i))),v=_,_=p,p=E(l,30),l=h,h=r;h=g(h,o),l=g(l,s),p=g(p,a),_=g(_,c),v=g(v,u)}return[h,l,p,_,v]}function f(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function m(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function _(e,t){var n=v(e);n.length>16&&(n=p(n,8*e.length));for(var i=new Array(16),r=new Array(16),o=0;o<16;o++)i[o]=909522486^n[o],r[o]=1549556828^n[o];var s=p(i.concat(v(t)),512+8*t.length);return p(r.concat(s),672)}function g(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function E(e,t){return e<<t|e>>>32-t}function v(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function S(e){for(var t,n,i="",r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)8*r+6*n>32*e.length?i+="=":i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return i}function y(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}var T={b64_hmac_sha1:function(e,t){return S(_(e,t))},b64_sha1:function(e){return S(p(v(e),8*e.length))},binb2str:y,core_hmac_sha1:_,str_hmac_sha1:function(e,t){return y(_(e,t))},str_sha1:function(e){return y(p(v(e),8*e.length))}},b=function(e){var t,n,i="",r=e.length;for(t=0;t<r;t++)(n=e.charCodeAt(t))>=0&&n<=127?i+=e.charAt(t):n>2047?(i+=String.fromCharCode(224|n>>12&15),i+=String.fromCharCode(128|n>>6&63),i+=String.fromCharCode(128|n>>0&63)):(i+=String.fromCharCode(192|n>>6&31),i+=String.fromCharCode(128|n>>0&63));return i},C=function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var i="",r="",o="",s=e[t],a="object"===n(s),c=escape(unescape(a?s.value:s));a&&(i=s.expires?";expires="+s.expires:"",r=s.domain?";domain="+s.domain:"",o=s.path?";path="+s.path:""),document.cookie=t+"="+c+i+r+o}};function A(e,t){return new I.Builder(e,t)}function N(e){return new I.Builder("iq",e)}function O(e){return new I.Builder("presence",e)}var I={VERSION:"@VERSION@",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<I.XHTML.tags.length;t++)if(e===I.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==I.XHTML.attributes[e]&&I.XHTML.attributes[e].length>0)for(var n=0;n<I.XHTML.attributes[e].length;n++)if(t===I.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<I.XHTML.css.length;t++)if(e===I.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){I.NS[e]=t},forEachChild:function(e,t,n){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];r.nodeType!==I.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return I._xmlGenerator||(I._xmlGenerator=I._makeGenerator()),I._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;for(var t=I.xmlGenerator().createElement(e),i=1;i<arguments.length;i++){var r=arguments[i];if(r)if("string"==typeof r||"number"==typeof r)t.appendChild(I.xmlTextNode(r));else if("object"===n(r)&&"function"==typeof r.sort)for(var o=0;o<r.length;o++){var s=r[o];"object"===n(s)&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&t.setAttribute(s[0],s[1])}else if("object"===n(r))for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&void 0!==r[a]&&null!==r[a]&&t.setAttribute(a,r[a])}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return I.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;return DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===I.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===I.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return I.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===I.ElementType.NORMAL){t=I.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var i=0;i<e.childNodes.length;i++)t.appendChild(I.copyElement(e.childNodes[i]))}else e.nodeType===I.ElementType.TEXT&&(t=I.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===I.ElementType.NORMAL){var i=e.nodeName.toLowerCase();if(I.XHTML.validTag(i))try{t=I.xmlElement(i);for(var r=0;r<I.XHTML.attributes[i].length;r++){var o=I.XHTML.attributes[i][r],s=e.getAttribute(o);if(null!=s&&""!==s&&!1!==s&&0!==s)if("style"===o&&"object"===n(s)&&void 0!==s.cssText&&(s=s.cssText),"style"===o){for(var a=[],c=s.split(";"),u=0;u<c.length;u++){var d=c[u].split(":"),h=d[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(I.XHTML.validCSS(h)){var l=d[1].replace(/^\s*/,"").replace(/\s*$/,"");a.push(h+": "+l)}}a.length>0&&(s=a.join("; "),t.setAttribute(o,s))}else t.setAttribute(o,s)}for(var p=0;p<e.childNodes.length;p++)t.appendChild(I.createHtml(e.childNodes[p]))}catch(e){t=I.xmlTextNode("")}else{t=I.xmlGenerator().createDocumentFragment();for(var f=0;f<e.childNodes.length;f++)t.appendChild(I.createHtml(e.childNodes[f]))}}else if(e.nodeType===I.ElementType.FRAGMENT){t=I.xmlGenerator().createDocumentFragment();for(var m=0;m<e.childNodes.length;m++)t.appendChild(I.createHtml(e.childNodes[m]))}else e.nodeType===I.ElementType.TEXT&&(t=I.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=I.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){if(!e)return null;var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&I.fatal(e.stack),e.sourceURL?I.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?I.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):I.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"===n(window.console)&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t=i(Array(e.attributes.length).keys()).map((function(t){return e.attributes[t].nodeName}));t.sort();var n=t.reduce((function(t,n){return"".concat(t," ").concat(n,'="').concat(I.xmlescape(e.attributes.getNamedItem(n).value),'"')}),"<".concat(e.nodeName));if(e.childNodes.length>0){n+=">";for(var r=0;r<e.childNodes.length;r++){var o=e.childNodes[r];switch(o.nodeType){case I.ElementType.NORMAL:n+=I.serialize(o);break;case I.ElementType.TEXT:n+=I.xmlescape(o.nodeValue);break;case I.ElementType.CDATA:n+="<![CDATA["+o.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){I._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=I.NS.CLIENT:t||(t={xmlns:I.NS.CLIENT})),this.nodeTree=I.xmlElement(e,t),this.node=this.nodeTree}};I.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return I.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var i=I.xmlElement(e,t,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this},cnode:function(e){var t,n=I.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var i=t?n.importNode(e,!0):I.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(e){var t=I.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=I.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},I.Handler=function(e,t,n,i,r,o,s){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=r,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(I.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?I.getBareJidFromJid(o):null:this.from=o,this.user=!0},I.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(I.forEachChild(e,null,(function(e){t.getNamespace(e)===t.ns&&(n=!0)})),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=I.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!I.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw I._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},I.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},I.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},I.Connection=function(e,t){var n=this;this.service=e,this.options=t||{};var i=this.options.protocol||"";for(var r in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===i.indexOf("ws")?this._proto=new I.Websocket(this):this._proto=new I.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((function(){return n._onIdle()}),100),C(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),I._connectionPlugins)if(Object.prototype.hasOwnProperty.call(I._connectionPlugins,r)){var o=function(){};o.prototype=I._connectionPlugins[r],this[r]=new o,this[r].init(this)}},I.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,i,r,o,s){this.jid=e,this.authzid=I.getBareJidFromJid(this.jid),this.authcid=s||I.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=I.getDomainFromJid(this.jid),this._changeConnectStatus(I.Status.CONNECTING,null),this._proto._connect(i,r,o)},attach:function(e,t,n,i,r,o,s){if(!(this._proto instanceof I.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(e,t,n,i,r,o,s)},restore:function(e,t,n,i,r){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(e,t,n,i,r)},_sessionCachingSupported:function(){if(this._proto instanceof I.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,i){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler((function(e){o&&r.deleteTimedHandler(o),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)}),null,"presence",null,s);i&&(o=this.addTimedHandler(i,(function(){return r.deleteHandler(a),n&&n(null),!1})))}return this.send(e),s},sendIQ:function(e,t,n,i){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler((function(e){o&&r.deleteTimedHandler(o);var i=e.getAttribute("type");if("result"===i)t&&t(e);else{if("error"!==i){var s=new Error("Got bad IQ type of ".concat(i));throw s.name="StropheError",s}n&&n(e)}}),null,"iq",["error","result"],s);i&&(o=this.addTimedHandler(i,(function(){return r.deleteHandler(a),n&&n(null),!1})))}return this.send(e),s},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((function(){return e._onIdle()}),100)},addTimedHandler:function(e,t){var n=new I.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,i,r,o,s){var a=new I.Handler(e,t,n,i,r,o,s);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[I.SASLAnonymous,I.SASLExternal,I.SASLMD5,I.SASLOAuthBearer,I.SASLXOAuth2,I.SASLPlain,I.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(I.Status.DISCONNECTING,e),I.warn("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=O({xmlns:I.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else I.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var i in I._connectionPlugins)if(Object.prototype.hasOwnProperty.call(I._connectionPlugins,i)){var r=this[i];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){I.error("".concat(i," plugin caused an exception changing status: ").concat(e))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){I._handleError(e),I.error("User connection callback caused an exception: ".concat(e))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),I.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(I.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){var n=this;I.debug("_dataRecv called");var i=this._proto._reqToData(e);if(null!==i){for(this.xmlInput!==I.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==I.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(I.serialize(i)));this.removeHandlers.length>0;){var r=this.removeHandlers.pop(),o=this.handlers.indexOf(r);o>=0&&this.handlers.splice(o,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var s=i.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;var a=i.getAttribute("condition"),c=i.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus(I.Status.CONNFAIL,a)):this._changeConnectStatus(I.Status.CONNFAIL,I.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}I.forEachChild(i,null,(function(e){var t=n.handlers;n.handlers=[];for(var i=0;i<t.length;i++){var r=t[i];try{(!r.isMatch(e)||!n.authenticated&&r.user||r.run(e))&&n.handlers.push(r)}catch(e){I.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}}))}}},mechanisms:{},_connect_cb:function(e,t,n){var i;I.debug("_connect_cb was called"),this.connected=!0;try{i=this._proto._reqToData(e)}catch(e){if(e.name!==I.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(I.Status.CONNFAIL,I.ErrorCondition.BAD_FORMAT),this._doDisconnect(I.ErrorCondition.BAD_FORMAT)}if(i&&(this.xmlInput!==I.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==I.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(I.serialize(i))),this._proto._connect_cb(i)!==I.Status.CONNFAIL))if(i.getElementsByTagNameNS?i.getElementsByTagNameNS(I.NS.STREAM,"features").length>0:i.getElementsByTagName("stream:features").length>0||i.getElementsByTagName("features").length>0){var r=[],o=i.getElementsByTagName("mechanism");if(o.length>0)for(var s=0;s<o.length;s++){var a=I.getText(o[s]);this.mechanisms[a]&&r.push(this.mechanisms[a])}0!==r.length||0!==i.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,i=t+1;i<e.length;++i)e[i].prototype.priority>e[n].prototype.priority&&(n=i);if(n!==t){var r=e[t];e[t]=e[n],e[n]=r}}return e},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var i=A("auth",{xmlns:I.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var r=this._sasl_mechanism.onChallenge(this,null);i.t(btoa(r))}this.send(i.tree()),t=!0;break}return t},_sasl_challenge_cb:function(e){var t=atob(I.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),i=A("response",{xmlns:I.NS.SASL});return""!==n&&i.t(btoa(n)),this.send(i.tree()),!0},_attemptLegacyAuth:function(){null===I.getNodeFromJid(this.jid)?(this._changeConnectStatus(I.Status.CONNFAIL,I.ErrorCondition.MISSING_JID_NODE),this.disconnect(I.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(I.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(N({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:I.NS.AUTH}).c("username",{}).t(I.getNodeFromJid(this.jid)).tree()))},_onLegacyAuthIQResult:function(e){var t=N({type:"set",id:"_auth_2"}).c("query",{xmlns:I.NS.AUTH}).c("username",{}).t(I.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return I.getResourceFromJid(this.jid)||(this.jid=I.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(I.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){var t=this;if(this._sasl_data["server-signature"]){var n,i=atob(I.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===i[1]&&(n=i[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}I.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var r=[],o=function(e,n){for(;e.length;)t.deleteHandler(e.pop());return t._onStreamFeaturesAfterSASL(n),!1};return r.push(this._addSysHandler((function(e){return o(r,e)}),null,"stream:features",null,null)),r.push(this._addSysHandler((function(e){return o(r,e)}),I.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_onStreamFeaturesAfterSASL:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(I.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(I.Status.AUTHFAIL,null),!1)},bind:function(){if(this.do_bind){this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");var e=I.getResourceFromJid(this.jid);e?this.send(N({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:I.NS.BIND}).c("resource",{}).t(e).tree()):this.send(N({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:I.NS.BIND}).tree())}else I.log(I.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false')},_onResourceBindResultIQ:function(e){var t;if("error"===e.getAttribute("type"))return I.warn("Resource binding failed."),e.getElementsByTagName("conflict").length>0&&(t=I.ErrorCondition.CONFLICT),this._changeConnectStatus(I.Status.AUTHFAIL,t,e),!1;var n=e.getElementsByTagName("bind");if(!(n.length>0))return I.warn("Resource binding failed."),this._changeConnectStatus(I.Status.AUTHFAIL,null,e),!1;var i=n[0].getElementsByTagName("jid");i.length>0&&(this.jid=I.getText(i[0]),this.do_session?this._establishSession():(this.authenticated=!0,this._changeConnectStatus(I.Status.CONNECTED,null)))},_establishSession:function(){if(!this.do_session)throw new Error("Strophe.Connection.prototype._establishSession "+"called but apparently ".concat(I.NS.SESSION," wasn't advertised by the server"));this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(N({type:"set",id:"_session_auth_2"}).c("session",{xmlns:I.NS.SESSION}).tree())},_onSessionResultIQ:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(I.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return I.warn("Session creation failed."),this._changeConnectStatus(I.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(I.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(I.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(I.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new I.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,i,r){var o=new I.Handler(e,t,n,i,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return I.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(I.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);n>=0&&this.timedHandlers.splice(n,1)}for(var i=(new Date).getTime(),r=[],o=0;o<this.timedHandlers.length;o++){var s=this.timedHandlers[o];!this.authenticated&&s.user||(s.lastCalled+s.period-i<=0?s.run()&&r.push(s):r.push(s))}this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((function(){return e._onIdle()}),100))}},I.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},I.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},I.SASLAnonymous=function(){},I.SASLAnonymous.prototype=new I.SASLMechanism("ANONYMOUS",!1,20),I.SASLAnonymous.prototype.test=function(e){return null===e.authcid},I.SASLPlain=function(){},I.SASLPlain.prototype=new I.SASLMechanism("PLAIN",!0,50),I.SASLPlain.prototype.test=function(e){return null!==e.authcid},I.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,b(t)},I.SASLSHA1=function(){},I.SASLSHA1.prototype=new I.SASLMechanism("SCRAM-SHA-1",!0,70),I.SASLSHA1.prototype.test=function(e){return null!==e.authcid},I.SASLSHA1.prototype.onChallenge=function(e,t,n){var i=n||l.hexdigest(""+1234567890*Math.random()),r="n="+b(e.authcid);return r+=",r=",r+=i,e._sasl_data.cnonce=i,e._sasl_data["client-first-message-bare"]=r,r="n,,"+r,this.onChallenge=function(e,t){for(var n,i,r,o,s,a,c,u,d="c=biws,",h="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),l=e._sasl_data.cnonce,p=/([a-z]+)=([^,]+)(,|$)/;t.match(p);){var f=t.match(p);switch(t=t.replace(f[0],""),f[1]){case"r":n=f[2];break;case"s":i=f[2];break;case"i":r=f[2]}}if(n.substr(0,l.length)!==l)return e._sasl_data={},e._sasl_failure_cb();h+=d+="r="+n,i=atob(i),i+="\0\0\0";var m=b(e.pass);for(o=a=T.core_hmac_sha1(m,i),c=1;c<r;c++){for(s=T.core_hmac_sha1(m,T.binb2str(a)),u=0;u<5;u++)o[u]^=s[u];a=s}o=T.binb2str(o);var _=T.core_hmac_sha1(o,"Client Key"),g=T.str_hmac_sha1(o,"Server Key"),E=T.core_hmac_sha1(T.str_sha1(T.binb2str(_)),h);for(e._sasl_data["server-signature"]=T.b64_hmac_sha1(g,h),u=0;u<5;u++)_[u]^=E[u];return d+=",p="+btoa(T.binb2str(_))},r},I.SASLMD5=function(){},I.SASLMD5.prototype=new I.SASLMechanism("DIGEST-MD5",!1,60),I.SASLMD5.prototype.test=function(e){return null!==e.authcid},I.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},I.SASLMD5.prototype.onChallenge=function(e,t,n){for(var i=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,r=n||l.hexdigest(""+1234567890*Math.random()),o="",s=null,a="";t.match(i);){var c=t.match(i);switch(t=t.replace(c[0],""),c[2]=c[2].replace(/^"(.+)"$/,"$1"),c[1]){case"realm":o=c[2];break;case"nonce":a=c[2];break;case"qop":c[2];break;case"host":s=c[2]}}var u=e.servtype+"/"+e.domain;null!==s&&(u=u+"/"+s);var d=b(e.authcid+":"+o+":"+this._connection.pass),h=l.hash(d)+":"+a+":"+r,p="AUTHENTICATE:"+u,f="";return f+="charset=utf-8,",f+="username="+this._quote(b(e.authcid))+",",f+="realm="+this._quote(o)+",",f+="nonce="+this._quote(a)+",",f+="nc=00000001,",f+="cnonce="+this._quote(r)+",",f+="digest-uri="+this._quote(u)+",",f+="response="+l.hexdigest(l.hexdigest(h)+":"+a+":00000001:"+r+":auth:"+l.hexdigest(p))+",",f+="qop=auth",this.onChallenge=function(){return""},f},I.SASLOAuthBearer=function(){},I.SASLOAuthBearer.prototype=new I.SASLMechanism("OAUTHBEARER",!0,40),I.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},I.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",b(t+="")},I.SASLExternal=function(){},I.SASLExternal.prototype=new I.SASLMechanism("EXTERNAL",!0,10),I.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},I.SASLXOAuth2=function(){},I.SASLXOAuth2.prototype=new I.SASLMechanism("X-OAUTH2",!0,30),I.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},I.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,b(t)};var R={Strophe:I,$build:A,$iq:N,$msg:function(e){return new I.Builder("message",e)},$pres:O,SHA1:T,MD5:l,b64_hmac_sha1:T.b64_hmac_sha1,b64_sha1:T.b64_sha1,str_hmac_sha1:T.str_hmac_sha1,str_sha1:T.str_sha1},D=R.Strophe,P=R.$build;D.Request=function(e,t,n,i){this.id=++D._requestId,this.xmlData=e,this.data=D.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},D.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw D.error("invalid response received"),D.error("responseText: "+this.xhr.responseText),D.error("responseXML: "+D.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(D.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){D.error("invalid response received: "+e.querySelector("parsererror").textContent),D.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=D.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},D.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},D.Bosh.prototype={strip:null,_buildBody:function(){var e=P("body",{rid:this.rid++,xmlns:D.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":D.NS.BOSH});n&&i.attrs({route:n});var r=this._conn._connect_cb;this._requests.push(new D.Request(i.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,i,r,o,s){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=i,this._conn.domain=D.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(D.Status.ATTACHED,null)},_restore:function(e,t,n,i,r){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||D.getBareJidFromJid(o.jid)===D.getBareJidFromJid(e)||null===D.getNodeFromJid(e)&&D.getDomainFromJid(o.jid)===e))){var s=new Error("_restore: no restoreable session.");throw s.name="StropheSessionError",s}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,i,r)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");D.error("BOSH-Connection failed: "+n);var i=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&i.length>0&&(n="conflict"),this._conn._changeConnectStatus(D.Status.CONNFAIL,n)):this._conn._changeConnectStatus(D.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),D.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10));var a=e.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,D.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){D.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new D.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(D.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":D.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new D.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(D.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(D.TIMEOUT*this.wait)&&(D.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(D.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){D.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(D.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)t.abort=!1;else if(4===t.xhr.readyState){var n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);var i=n>0&&n<500,r=t.sends>this._conn.maxRetries;if((i||r)&&(this._removeRequest(t),D.debug("request id "+t.id+" should now be removed")),200===n){var o=this._requests[0]===t;(this._requests[1]===t||o&&this._requests.length>0&&this._requests[0].age()>Math.floor(D.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),D.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||n>=400&&n<600||n>=12e3?(D.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(D.Status.DISCONNECTING,null),this._conn._doDisconnect())):D.error("request id "+t.id+"."+t.sends+" error "+n+" happened");i||r?r&&!this._conn.connected&&this._conn._changeConnectStatus(D.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],i=this._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var r=n.age(),o=!isNaN(r)&&r>Math.floor(D.TIMEOUT*this.wait),s=null!==n.dead&&n.timeDead()>Math.floor(D.SECONDARY_TIMEOUT*this.wait),a=4===n.xhr.readyState&&(i<1||i>=500);if((o||s||a)&&(s&&D.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new D.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){D.debug("request id "+n.id+"."+n.sends+" posting");try{var c=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",c),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return D.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(D.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.xhr.setRequestHeader(i,e[i])}n.xhr.send(n.data)};if(n.sends>1){var d=1e3*Math.min(Math.floor(D.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout((function(){u()}),d)}else u();n.sends++,this._conn.xmlOutput!==D.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==D.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else D.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)}},_removeRequest:function(e){D.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){D.debug("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new D.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((function(){return e._conn._onIdle()}),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?D.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):D.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}};var L=R.Strophe,w=R.$build;return L.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},L.Websocket.prototype={_buildStream:function(){return w("open",{xmlns:L.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(L.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var i=n[0],r="",o="",s=0;s<i.childNodes.length;s++){var a=i.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?o=a.textContent:r=a.nodeName}var c="WebSocket stream error: ";return c+=r||"unknown",o&&(c+=" - "+o),L.error(c),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,L.Status.CONNFAIL))return L.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==L.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var i=e.getAttribute("version");return"string"!=typeof i?t="Missing version in <open />":"1.0"!==i&&(t="Wrong version in <open />: "+i),!t||(this._conn._changeConnectStatus(L.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var i=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(e.data);var r=i.getAttribute("see-other-uri");if(r){var o=this._conn.service;(o.indexOf("wss:")>=0&&r.indexOf("wss:")>=0||o.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(L.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=r,this._connect())}else this._conn._changeConnectStatus(L.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var s=this._streamWrap(e.data),a=(new DOMParser).parseFromString(s,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t=w("close",{xmlns:L.NS.FRAMING});this._conn.xmlOutput(t.tree());var n=L.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){L.warn("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){L.debug("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){L.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(L.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(L.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(L.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):L.debug("Websocket closed")},_no_auth_received:function(e){L.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(L.Status.CONNFAIL,L.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){L.error("Websocket error "+e),this._conn._changeConnectStatus(L.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n=void 0;n="restart"===e[t]?this._buildStream().tree():e[t];var i=L.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var i=this._streamWrap(e.data);t=(new DOMParser).parseFromString(i,"text/xml").documentElement}return this._check_streamerror(t,L.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(L.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){L.debug("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=L.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},e.Strophe=R.Strophe,e.$build=R.$build,e.$iq=R.$iq,e.$msg=R.$msg,e.$pres=R.$pres,R},e.exports=n()}).call(this,n(39))},function(e,t){},function(e,t,n){"use strict";n.r(t),n.d(t,"AUTHENTICATION_REQUIRED",(function(){return i})),n.d(t,"CHAT_ERROR",(function(){return r})),n.d(t,"CONFERENCE_DESTROYED",(function(){return o})),n.d(t,"CONFERENCE_MAX_USERS",(function(){return s})),n.d(t,"CONNECTION_ERROR",(function(){return a})),n.d(t,"CONFERENCE_RESTARTED",(function(){return c})),n.d(t,"NOT_ALLOWED_ERROR",(function(){return u})),n.d(t,"MEMBERS_ONLY_ERROR",(function(){return d})),n.d(t,"CONFERENCE_ACCESS_DENIED",(function(){return h})),n.d(t,"FOCUS_DISCONNECTED",(function(){return l})),n.d(t,"FOCUS_LEFT",(function(){return p})),n.d(t,"GRACEFUL_SHUTDOWN",(function(){return f})),n.d(t,"ICE_FAILED",(function(){return m})),n.d(t,"INCOMPATIBLE_SERVER_VERSIONS",(function(){return _})),n.d(t,"OFFER_ANSWER_FAILED",(function(){return g})),n.d(t,"PASSWORD_NOT_SUPPORTED",(function(){return E})),n.d(t,"PASSWORD_REQUIRED",(function(){return v})),n.d(t,"RESERVATION_ERROR",(function(){return S})),n.d(t,"VIDEOBRIDGE_NOT_AVAILABLE",(function(){return y}));const i="conference.authenticationRequired",r="conference.chatError",o="conference.destroyed",s="conference.max_users",a="conference.connectionError",c="conference.restarted",u="conference.connectionError.notAllowed",d="conference.connectionError.membersOnly",h="conference.connectionError.accessDenied",l="conference.focusDisconnected",p="conference.focusLeft",f="conference.gracefulShutdown",m="conference.iceFailed",_="conference.incompatible_server_versions",g="conference.offerAnswerFailed",E="conference.passwordNotSupported",v="conference.passwordRequired",S="conference.reservationError",y="conference.videobridgeNotAvailable"},function(e,t,n){"use strict";n.r(t),n.d(t,"CONSTRAINT_FAILED",(function(){return i})),n.d(t,"ELECTRON_DESKTOP_PICKER_ERROR",(function(){return r})),n.d(t,"ELECTRON_DESKTOP_PICKER_NOT_FOUND",(function(){return o})),n.d(t,"GENERAL",(function(){return s})),n.d(t,"NOT_FOUND",(function(){return a})),n.d(t,"PERMISSION_DENIED",(function(){return c})),n.d(t,"SCREENSHARING_GENERIC_ERROR",(function(){return u})),n.d(t,"SCREENSHARING_USER_CANCELED",(function(){return d})),n.d(t,"TIMEOUT",(function(){return h})),n.d(t,"TRACK_IS_DISPOSED",(function(){return l})),n.d(t,"TRACK_NO_STREAM_FOUND",(function(){return p})),n.d(t,"UNSUPPORTED_RESOLUTION",(function(){return f}));const i="gum.constraint_failed",r="gum.electron_desktop_picker_error",o="gum.electron_desktop_picker_not_found",s="gum.general",a="gum.not_found",c="gum.permission_denied",u="gum.screensharing_generic_error",d="gum.screensharing_user_canceled",h="gum.timeout",l="track.track_is_disposed",p="track.no_stream_found",f="gum.unsupported_resolution"},function(e,t){},function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DISCONNECTED",(function(){return i})),n.d(t,"CONNECTION_ESTABLISHED",(function(){return r})),n.d(t,"CONNECTION_FAILED",(function(){return o})),n.d(t,"WRONG_STATE",(function(){return s})),n.d(t,"DISPLAY_NAME_REQUIRED",(function(){return a}));const i="connection.connectionDisconnected",r="connection.connectionEstablished",o="connection.connectionFailed",s="connection.wrongState",a="connection.display_name_required"},function(e,t,n){"use strict";t.a=window.document},function(e,t){},function(e,t){},function(e,t,n){"use strict";t.a=[]},function(e,t,n){var i=n(45),r=n(93),o={},s=[],a=i.levels.TRACE;e.exports={addGlobalTransport:function(e){i.addGlobalTransport(e)},removeGlobalTransport:function(e){i.removeGlobalTransport(e)},setGlobalOptions:function(e){i.setGlobalOptions(e)},getLogger:function(e,t,n){var r=new i(a,e,t,n);return e?(o[e]=o[e]||[],o[e].push(r)):s.push(r),r},setLogLevelById:function(e,t){for(var n=t?o[t]||[]:s,i=0;i<n.length;i++)n[i].setLevel(e)},setLogLevel:function(e){a=e;for(var t=0;t<s.length;t++)s[t].setLevel(e);for(var n in o){var i=o[n]||[];for(t=0;t<i.length;t++)i[t].setLevel(e)}},levels:i.levels,LogCollector:r}},function(e,t,n){"use strict";var i=n(14);t.a=i.a.push},function(e,t,n){"use strict";(function(e,i){n.d(t,"c",(function(){return F})),n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return k})),n.d(t,"d",(function(){return H}));var r=n(15),o=n(5),s=(n(95),n(19)),a=n(10),c=n(2),u=n.n(c),d=n(13),h=n.n(d),l=n(29),p=n(20),f=n.n(p),m=n(34),_=n.n(m),g=n(41),E=n.n(g),v=n(42),S=n.n(v),y=n(43),T=n.n(y),b=n(54),C=n.n(b),A=n(55),N=n.n(A),O=n(56),I=n.n(O),R=n(57),D=n.n(R),P=n(58),L=n.n(P);const w=Object(r.getLogger)(e),M=/<failure.*><not-allowed\/><text>(.*)<\/text><\/failure>/gi;const x=[{urls:"stun:meet-jit-si-turnrelay.jitsi.net:443"}],F="type",j="http://jitsi.org/protocol/jigasi",k="https://jitsi.org/meet/e2ee";class H extends _.a{constructor(e,t,n){var i;super(),this.connection=null,this.disconnectInProgress=!1,this.connectionTimes={},this.options=e,this.token=t,this.authenticatedUser=!1,L()(),I()();const r=e.xmppPing||{};r.domain=e.hosts.domain,this.connection=function({enableWebsocketResume:e,name:t,serviceUrl:n="/http-bind",shard:i,token:r,websocketKeepAlive:o,websocketKeepAliveUrl:s,xmppPing:a}){return r&&(n+=`${-1===n.indexOf("?")?"?":"&"}token=${r}&room=${t}`),new T.a({enableWebsocketResume:e,serviceUrl:n,name:t,websocketKeepAlive:o,websocketKeepAliveUrl:s,xmppPing:a,shard:i})}({name:n,enableWebsocketResume:e.enableWebsocketResume,serviceUrl:e.serviceUrl||e.bosh,token:t,websocketKeepAlive:e.websocketKeepAlive,websocketKeepAliveUrl:e.websocketKeepAliveUrl,xmppPing:r,shard:null===(i=e.deploymentInfo)||void 0===i?void 0:i.shard}),this.connection.on(T.a.Events.CONN_SHARD_CHANGED,()=>{const e={shard_changed:!0,suspend_time:this.connection.ping.getPingSuspendTime(),time_since_last_success:this.connection.getTimeSinceLastSuccess()};this.eventEmitter.emit(a.CONNECTION_FAILED,s.OTHER_ERROR,void 0,void 0,e)}),this._initStrophePlugins(),this.caps=new S.a(this.connection,this.options.clientNode),this.initFeaturesList()}initFeaturesList(){this.caps.addFeature("urn:xmpp:jingle:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.caps.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:dtls:0"),this.caps.addFeature("urn:xmpp:jingle:transports:dtls-sctp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:video"),this.options.disableRtx||h.a.isFirefox()&&h.a.isVersionLessThan(84)||this.caps.addFeature("urn:ietf:rfc:4588"),!0===this.options.enableOpusRed&&h.a.supportsAudioRed()&&this.caps.addFeature("http://jitsi.org/opus-red"),(void 0===this.options.enableRemb||this.options.enableRemb)&&this.caps.addFeature("http://jitsi.org/remb"),(void 0===this.options.enableTcc||this.options.enableTcc)&&this.caps.addFeature("http://jitsi.org/tcc"),this.caps.addFeature("urn:ietf:rfc:5761"),this.caps.addFeature("urn:ietf:rfc:5888"),h.a.isChromiumBased()&&!0===this.options.enableLipSync&&(w.info("Lip-sync enabled !"),this.caps.addFeature("http://jitsi.org/meet/lipsync")),this.connection.rayo&&this.caps.addFeature("urn:xmpp:rayo:client:1"),l.E2EEncryption.isSupported(this.options)&&this.caps.addFeature(k,!1,!0)}getConnection(){return this.connection}connectionHandler(e={},t,n){const i=window.performance.now(),r=o.Strophe.getStatusString(t).toLowerCase();if(this.connectionTimes[r]=i,w.log(`(TIME) Strophe ${r}${n?`[${n}]`:""}:\t`,i),this.eventEmitter.emit(u.a.CONNECTION_STATUS_CHANGED,e,t,n),t===o.Strophe.Status.CONNECTED||t===o.Strophe.Status.ATTACHED)this._sysMessageHandler&&this.connection._stropheConn.deleteHandler(this._sysMessageHandler),this.sendDiscoInfo&&this.connection.jingle.getStunAndTurnCredentials(),w.info("My Jabber ID: "+this.connection.jid),this._resetState(),this.sendDiscoInfo&&this.caps.getFeaturesAndIdentities(this.options.hosts.domain).then(({features:e,identities:t})=>{e.has(o.Strophe.NS.PING)||w.error(`Ping NOT supported by ${this.options.hosts.domain} - please enable ping in your XMPP server config`),this._processDiscoInfoIdentities(t,void 0)}).catch(e=>{const t="Feature discovery error";f.a.callErrorHandler(new Error(`${t}: ${e}`)),w.error(t,e)}),this.sendDiscoInfo=!1,e.password&&(this.authenticatedUser=!0),this.connection&&this.connection.connected&&o.Strophe.getResourceFromJid(this.connection.jid)&&this.eventEmitter.emit(a.CONNECTION_ESTABLISHED,o.Strophe.getResourceFromJid(this.connection.jid));else if(t===o.Strophe.Status.CONNFAIL)"x-strophe-bad-non-anon-jid"===n?this.anonymousConnectionFailed=!0:this.connectionFailed=!0,this.lastErrorMsg=n,"giving-up"===n&&this.eventEmitter.emit(a.CONNECTION_FAILED,s.OTHER_ERROR,n);else if(t===o.Strophe.Status.ERROR)this.lastErrorMsg=n;else if(t===o.Strophe.Status.DISCONNECTED){this.connection.ping.stopInterval();const e=Boolean(this.disconnectInProgress),t=n||this.lastErrorMsg;if(this.anonymousConnectionFailed)this.eventEmitter.emit(a.CONNECTION_FAILED,s.PASSWORD_REQUIRED);else if(this.connectionFailed)this.eventEmitter.emit(a.CONNECTION_FAILED,s.OTHER_ERROR,t,void 0,this._getConnectionFailedReasonDetails());else if(e)this.eventEmitter.emit(a.CONNECTION_DISCONNECTED,t);else{w.error("XMPP connection dropped!");const e=o.Strophe.getLastErrorStatus();e>=500&&e<600?this.eventEmitter.emit(a.CONNECTION_FAILED,s.SERVER_ERROR,t||"server-error",void 0,this._getConnectionFailedReasonDetails()):this.eventEmitter.emit(a.CONNECTION_FAILED,s.CONNECTION_DROPPED_ERROR,t||"connection-dropped-error",void 0,this._getConnectionFailedReasonDetails())}}else if(t===o.Strophe.Status.AUTHFAIL){const t=this.getConnection().getLastFailedMessage();this.eventEmitter.emit(a.CONNECTION_FAILED,s.PASSWORD_REQUIRED,n||this._parseConnectionFailedMessage(t),e)}}_processDiscoInfoIdentities(e,t){e.forEach(e=>{if("speakerstats"===e.type&&(this.speakerStatsComponentAddress=e.name),"conference_duration"===e.type&&(this.conferenceDurationComponentAddress=e.name),"lobbyrooms"===e.type){this.lobbySupported=!0;const n=e=>{e.forEach(e=>{e.endsWith("#displayname_required")&&this.eventEmitter.emit(a.DISPLAY_NAME_REQUIRED)})};t?n(t):e.name&&this.caps.getFeaturesAndIdentities(e.name,e.type).then(({features:e})=>n(e)).catch(e=>w.warn("Error getting features from lobby.",e&&e.message))}}),(this.speakerStatsComponentAddress||this.conferenceDurationComponentAddress)&&this.connection.addHandler(this._onPrivateMessage.bind(this),null,"message",null,null)}_parseConnectionFailedMessage(e){if(!e)return null;const t=M.exec(e);return t?t[1]:null}_connect(e,t){this._resetState(),this.sendDiscoInfo=!0,this.connection._stropheConn&&this.connection._stropheConn._addSysHandler?(this._sysMessageHandler=this._onSystemMessage.bind(this),this.connection._stropheConn._addSysHandler(this._sysMessageHandler,null,"message")):w.warn("Cannot attach strophe system handler, jiconop cannot operate"),this.connection.connect(e,t,this.connectionHandler.bind(this,{jid:e,password:t}))}_onSystemMessage(e){this.sendDiscoInfo=!1;const t=this.connection.jingle.onReceiveStunAndTurnCredentials(e),{features:n,identities:i}=Object(v.parseDiscoInfo)(e);this._processDiscoInfoIdentities(i,n),i.forEach(e=>{"shard"===e.type&&(this.options.deploymentInfo.shard=e.name)}),(t||i.size>0||n.size>0)&&(this.connection._stropheConn.deleteHandler(this._sysMessageHandler),this._sysMessageHandler=null)}attach(e){this._resetState(),this.sendDiscoInfo=!0;const t=this.connectionTimes.attaching=window.performance.now();w.log("(TIME) Strophe Attaching:\t",t),this.connection.attach(e.jid,e.sid,parseInt(e.rid,10)+1,this.connectionHandler.bind(this,{jid:e.jid,password:e.password}))}_resetState(){this.anonymousConnectionFailed=!1,this.connectionFailed=!1,this.lastErrorMsg=void 0,this.disconnectInProgress=void 0}connect(e,t){if(!e){const{anonymousdomain:t,domain:n}=this.options.hosts;let i=t||n;const{location:r}=window;if(t){const e=r&&r.search;(e&&-1!==e.indexOf("login=true")||this.token)&&(i=n)}e=i||r&&r.hostname}return this._connect(e,t)}createRoom(e,t,n){let i=`${e}@${t.customDomain?t.customDomain:this.options.hosts.muc.toLowerCase()}/`;const r=n?n(this.connection.jid,this.authenticatedUser):E.a.randomHexString(8).toLowerCase();return w.info(`JID ${this.connection.jid} using MUC nickname ${r}`),i+=r,this.connection.emuc.createRoom(i,null,t)}getJid(){return this.connection.jid}getJingleLog(){const e=this.connection.jingle;return e?e.getLog():{}}getXmppLog(){return(this.connection.logger||{}).log||null}dial(...e){this.connection.rayo.dial(...e)}ping(e){return new Promise((t,n)=>{this.connection.ping.ping(this.connection.pingDomain,t,n,e)})}getSessions(){return this.connection.jingle.sessions}disconnect(e){return this.disconnectInProgress?this.disconnectInProgress:this.connection?(this.disconnectInProgress=new Promise(e=>{const t=(n,i)=>{i===o.Strophe.Status.DISCONNECTED&&(e(),this.eventEmitter.removeListener(u.a.CONNECTION_STATUS_CHANGED,t))};this.eventEmitter.on(u.a.CONNECTION_STATUS_CHANGED,t)}),this._cleanupXmppConnection(e),this.disconnectInProgress):Promise.resolve()}_cleanupXmppConnection(e){if(!this.connection.isUsingWebSocket&&this.connection.flush(),!this.connection.isUsingWebSocket&&null!=e){const t=e.type;if(("beforeunload"===t||"unload"===t)&&(this.connection.options.sync=!0,this.connection.sendUnavailableBeacon()))return}this.connection.disconnect(),!0!==this.connection.options.sync&&this.connection.flush()}_initStrophePlugins(){const e={jvb:{iceServers:[]},p2p:{iceServers:[]}},t=this.options.p2p&&this.options.p2p.stunServers||x;Array.isArray(t)&&(w.info("P2P STUN servers: ",t),e.p2p.iceServers=t),this.options.p2p&&this.options.p2p.iceTransportPolicy&&(w.info("P2P ICE transport policy: ",this.options.p2p.iceTransportPolicy),e.p2p.iceTransportPolicy=this.options.p2p.iceTransportPolicy),this.connection.addConnectionPlugin("emuc",new C.a(this)),this.connection.addConnectionPlugin("jingle",new N.a(this,this.eventEmitter,e)),this.connection.addConnectionPlugin("rayo",new D.a)}_getConnectionFailedReasonDetails(){const e={};if(this.options.deploymentInfo&&this.options.deploymentInfo.shard&&this.connection.lastResponseHeaders){const t=this.connection.lastResponseHeaders.trim().split(/[\r\n]+/),n={};t.forEach(e=>{const t=e.split(": "),i=t.shift(),r=t.join(": ");n[i]=r}),e.shard_changed=this.options.deploymentInfo.shard!==n["x-jitsi-shard"]}return e.suspend_time=this.connection.ping.getPingSuspendTime(),e.time_since_last_success=this.connection.getTimeSinceLastSuccess(),e}sendDominantSpeakerEvent(e){if(!this.speakerStatsComponentAddress||!e)return;const t=Object(o.$msg)({to:this.speakerStatsComponentAddress});t.c("speakerstats",{xmlns:"http://jitsi.org/jitmeet",room:e}).up(),this.connection.send(t)}tryParseJSONAndVerify(e){try{const t=JSON.parse(e);if(t&&"object"==typeof t){const e=t[F];if(void 0!==e)return t;w.debug("parsing valid json but does not have correct structure","topic: ",e)}}catch(e){return w.error(e),!1}return!1}_onPrivateMessage(e){const t=e.getAttribute("from");if(t!==this.speakerStatsComponentAddress&&t!==this.conferenceDurationComponentAddress)return!0;const n=i(e).find(">json-message").text(),r=this.tryParseJSONAndVerify(n);return r&&"speakerstats"===r[F]&&r.users&&this.eventEmitter.emit(u.a.SPEAKER_STATS_RECEIVED,r.users),r&&"conference_duration"===r[F]&&r.created_timestamp&&this.eventEmitter.emit(u.a.CONFERENCE_TIMESTAMP_RECEIVED,r.created_timestamp),!0}}}).call(this,"src/modules/xmpp/xmpp.js",n(40))},function(e,t,n){"use strict";n.r(t),n.d(t,"LOCAL_TRACK_STOPPED",(function(){return i})),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",(function(){return r})),n.d(t,"TRACK_AUDIO_OUTPUT_CHANGED",(function(){return o})),n.d(t,"TRACK_MUTE_CHANGED",(function(){return s})),n.d(t,"TRACK_VIDEOTYPE_CHANGED",(function(){return a})),n.d(t,"NO_DATA_FROM_SOURCE",(function(){return c})),n.d(t,"NO_AUDIO_INPUT",(function(){return u}));const i="track.stopped",r="track.audioLevelsChanged",o="track.audioOutputChanged",s="track.trackMuteChanged",a="track.videoTypeChanged",c="track.no_data_from_source",u="track.no_audio_input"},function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DROPPED_ERROR",(function(){return i})),n.d(t,"OTHER_ERROR",(function(){return r})),n.d(t,"PASSWORD_REQUIRED",(function(){return o})),n.d(t,"SERVER_ERROR",(function(){return s}));const i="connection.droppedError",r="connection.otherError",o="connection.passwordRequired",s="connection.serverError"},function(e,t){},function(e,t,n){"use strict";t.a={}},function(e,t,n){"use strict";var i=n(14);t.a=i.a.indexOf},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t),n.d(t,"DEVICE_LIST_CHANGED",(function(){return i})),n.d(t,"PERMISSIONS_CHANGED",(function(){return r})),n.d(t,"PERMISSION_PROMPT_IS_SHOWN",(function(){return o})),n.d(t,"SLOW_GET_USER_MEDIA",(function(){return s}));const i="mediaDevices.devicechange",r="rtc.permissions_changed",o="mediaDevices.permissionPromptIsShown",s="mediaDevices.slowGetUserMedia"},function(e,t){},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o}));const i={disableAudioLevels:!0},r={hosts:{domain:"sariska.io",muc:"muc.sariska.io"},serviceUrl:"wss://api.sariska.io/api/v1/media/websocket",clientNode:"https://www.sariska.io"},o={openBridgeChannel:"websocket",hiddenDomain:"recorder.sariska.io",e2eping:{pingInterval:-1},p2p:{enabled:!1}}},function(e,t,n){"use strict";var i=n(8);const r={};function o(e,t,n){if("object"==typeof e&&void 0!==e.name)switch(this.gum={error:e,constraints:t,devices:n&&Array.isArray(n)?n.slice(0):void 0},e.name){case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":this.name=i.PERMISSION_DENIED,this.message=r[this.name]+(this.gum.devices||[]).join(", ");break;case"DevicesNotFoundError":case"NotFoundError":this.name=i.NOT_FOUND,this.message=r[this.name]+(this.gum.devices||[]).join(", ");break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":{const o=e.constraintName||e.constraint;t&&t.video&&(!n||n.indexOf("video")>-1)&&("minWidth"===o||"maxWidth"===o||"minHeight"===o||"maxHeight"===o||"width"===o||"height"===o||"deviceId"===o)?(this.name=i.UNSUPPORTED_RESOLUTION,this.message=r[this.name]+function(e,t){if(t&&t.video&&t.video.mandatory)switch(e){case"width":return t.video.mandatory.minWidth;case"height":return t.video.mandatory.minHeight;default:return t.video.mandatory[e]||""}return""}(o,t)):(this.name=i.CONSTRAINT_FAILED,this.message=r[this.name]+e.constraintName);break}default:this.name=i.GENERAL,this.message=e.message||r[this.name]}else{if("string"!=typeof e)throw new Error("Invalid arguments");r[e]?(this.name=e,this.message=t||r[e]):this.message=e}this.stack=e.stack||(new Error).stack}r[i.UNSUPPORTED_RESOLUTION]="Video resolution is not supported: ",r[i.SCREENSHARING_USER_CANCELED]="User canceled screen sharing prompt",r[i.SCREENSHARING_GENERIC_ERROR]="Unknown error from screensharing",r[i.ELECTRON_DESKTOP_PICKER_ERROR]="Unkown error from desktop picker",r[i.ELECTRON_DESKTOP_PICKER_NOT_FOUND]="Failed to detect desktop picker",r[i.GENERAL]="Generic getUserMedia error",r[i.PERMISSION_DENIED]="User denied permission to use device(s): ",r[i.NOT_FOUND]="Requested device(s) was/were not found: ",r[i.CONSTRAINT_FAILED]="Constraint could not be satisfied: ",r[i.TIMEOUT]="Could not start media source. Timeout occured!",r[i.TRACK_IS_DISPOSED]="Track has been already disposed",r[i.TRACK_NO_STREAM_FOUND]="Track does not have an associated Media Stream",o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,t.a=o},function(e,t){},function(e,t){},function(e,t,n){"use strict";var i=n(21);t.a=i.a.toString},function(e,t,n){"use strict";var i=n(21),r=n(31);t.a=function(e){return null==e?e+"":"object"==typeof e?i.a[r.a.call(e)]||"object":typeof e}},function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,n,i){var r,o,s,a;if(u(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=d(e))>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):_(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function _(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,d=_(c,u);for(n=0;n<u;++n)o(d[n],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,r,o,s;if(u(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";var i=n(33),r=n.n(i),o=n(25),s=n(9),a=n.n(s),c=n(13),u=n.n(c),d=n(3),h=n.n(d),l=n(4),p=n(12),f=n.n(p);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=new class{constructor(){this._eventEmitter=new r.a,this._permissions={},a.a.addListener(f.a.DEVICE_LIST_CHANGED,e=>this._eventEmitter.emit(o.DEVICE_LIST_CHANGED,e)),a.a.addListener(f.a.DEVICE_LIST_AVAILABLE,e=>this._logOutputDevice(this.getAudioOutputDevice(),e)),a.a.addListener(f.a.PERMISSIONS_CHANGED,e=>this._handlePermissionsChange(e)),this._permissionsApiSupported=new Promise(e=>{if(!navigator.permissions)return void e(!1);const t=this,n=[];n.push(navigator.permissions.query({name:"camera"}).then(e=>(this._handlePermissionsChange({[l.VIDEO]:this._parsePermissionState(e)}),e.onchange=function(){try{t._handlePermissionsChange({[l.VIDEO]:t._parsePermissionState(this)})}catch(e){}},!0)).catch(()=>!1)),n.push(navigator.permissions.query({name:"microphone"}).then(e=>(this._handlePermissionsChange({[l.AUDIO]:this._parsePermissionState(e)}),e.onchange=function(){try{t._handlePermissionsChange({[l.AUDIO]:t._parsePermissionState(this)})}catch(e){}},!0)).catch(()=>!1)),Promise.all(n).then(t=>e(t.every(e=>e)))})}_parsePermissionState(e={}){const t=e.state||e.status;if("string"!=typeof t)throw new TypeError;return"granted"===t}_handlePermissionsChange(e){[l.AUDIO,l.VIDEO].some(t=>t in e&&e[t]!==this._permissions[t])&&(this._permissions=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){m(e,t,n[t])}))}return e}({},this._permissions,e),this._eventEmitter.emit(o.PERMISSIONS_CHANGED,this._permissions),(this._permissions[l.AUDIO]||this._permissions[l.VIDEO])&&this.enumerateDevices(()=>{}))}_logOutputDevice(e,t){const n=t.find(t=>"audiooutput"===t.kind&&t.deviceId===e);n&&h.a.sendActiveDeviceListEvent(a.a.getEventDataForActiveDevice(n))}enumerateDevices(e){a.a.enumerateDevices(e)}isDeviceListAvailable(){return a.a.isDeviceListAvailable()}isDeviceChangeAvailable(e){return a.a.isDeviceChangeAvailable(e)}isDevicePermissionGranted(e){return new Promise(t=>{e in this._permissions?t(this._permissions[e]):this._permissionsApiSupported.then(n=>{if(!n)return void t(!1);const i=[];switch(e){case l.VIDEO:i.push(navigator.permissions.query({name:"camera"}));break;case l.AUDIO:i.push(navigator.permissions.query({name:"microphone"}));break;default:i.push(navigator.permissions.query({name:"camera"})),i.push(navigator.permissions.query({name:"microphone"}))}Promise.all(i).then(e=>t(e.every(e=>{try{return this._parsePermissionState(e)}catch(e){return!1}})),()=>t(!1))})})}isMultipleAudioInputSupported(){return!u.a.isFirefox()}getAudioOutputDevice(){return a.a.getAudioOutputDevice()}setAudioOutputDevice(e){return a.a.getCurrentlyAvailableMediaDevices().length>0&&this._logOutputDevice(e,a.a.getCurrentlyAvailableMediaDevices()),a.a.setAudioOutputDevice(e)}addEventListener(e,t){this._eventEmitter.addListener(e,t)}removeEventListener(e,t){this._eventEmitter.removeListener(e,t)}emitEvent(e,...t){this._eventEmitter.emit(e,...t)}}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);var i=n(0);var r=function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},o=n(11),s=o.a.documentElement,a=n(22),c=n(14),u=c.a.pop,d=n(16),h="[\\x20\\t\\r\\n\\f]",l=o.a.documentMode,p=l&&new RegExp(":enabled|:disabled|\\["+h+"*name"+h+"*="+h+"*(?:''|\"\")");i.a.contains=function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))};var f=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function m(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}i.a.escapeSelector=function(e){return(e+"").replace(f,m)};var _=c.a.sort;let g;function E(e,t){if(e===t)return g=!0,0;let n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n?e==o.a||e.ownerDocument==o.a&&i.a.contains(o.a,e)?-1:t==o.a||t.ownerDocument==o.a&&i.a.contains(o.a,t)?1:0:4&n?-1:1)}i.a.uniqueSort=function(e){let t,n=[],i=0,r=0;if(g=!1,_.call(e,E),g){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return e};var v=o.a,S=s.matches||s.msMatchesSelector;!function(){var e,t,n,o,s,c,f=i.a.expando,m=0,_=0,g=G(),E=G(),y=G(),T=G(),b="(?:\\\\[\\da-fA-F]{1,6}"+h+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",C="\\["+h+"*("+b+")(?:"+h+"*([*^$|!~]?=)"+h+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+b+"))|)"+h+"*\\]",A=":("+b+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+C+")*)|.*)\\)|)",N=new RegExp(h+"+","g"),O=new RegExp("^"+h+"+|((?:^|[^\\\\])(?:\\\\.)*)"+h+"+$","g"),I=new RegExp("^"+h+"*,"+h+"*"),R=new RegExp("^"+h+"*([>+~]|"+h+")"+h+"*"),D=new RegExp(h+"|>"),P=new RegExp(A),L=new RegExp("^"+b+"$"),w={ID:new RegExp("^#("+b+")"),CLASS:new RegExp("^\\.("+b+")"),TAG:new RegExp("^("+b+"|[*])"),ATTR:new RegExp("^"+C),PSEUDO:new RegExp("^"+A),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+h+"*(even|odd|(([+-]|)(\\d*)n|)"+h+"*(?:([+-]|)"+h+"*(\\d+)|))"+h+"*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^"+h+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+h+"*((?:-\\d)?\\d*)"+h+"*\\)|)(?=[^-]|$)","i")},M=/^(?:input|select|textarea|button)$/i,x=/^h\d$/i,F=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,j=/[+~]/,k=new RegExp("\\\\[\\da-fA-F]{1,6}"+h+"?|\\\\([^\\r\\n\\f])","g"),H=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},U=function(){Y()},J=te((function(e){return!0===e.disabled&&r(e,"fieldset")}),{dir:"parentNode",next:"legend"});function B(e){throw new Error("Syntax error, unrecognized expression: "+e)}function V(e,n,r,s){var a,u,h,m,_,g,E,v=n&&n.ownerDocument,S=n?n.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==S&&9!==S&&11!==S)return r;if(!s&&(Y(n),n=n||o,c)){if(11!==S&&(_=F.exec(e)))if(a=_[1]){if(9===S)return(h=n.getElementById(a))&&d.a.call(r,h),r;if(v&&(h=v.getElementById(a))&&i.a.contains(n,h))return d.a.call(r,h),r}else{if(_[2])return d.a.apply(r,n.getElementsByTagName(e)),r;if((a=_[3])&&n.getElementsByClassName)return d.a.apply(r,n.getElementsByClassName(a)),r}if(!(T[e+" "]||p&&p.test(e))){if(E=e,v=n,1===S&&(D.test(e)||R.test(e))){for(((v=j.test(e)&&z(n.parentNode)||n)!==n||l)&&((m=n.getAttribute("id"))?m=i.a.escapeSelector(m):n.setAttribute("id",m=f)),u=(g=Z(e)).length;u--;)g[u]=(m?"#"+m:":scope")+" "+ee(g[u]);E=g.join(",")}try{return d.a.apply(r,v.querySelectorAll(E)),r}catch(t){T(e,!0)}finally{m===f&&n.removeAttribute("id")}}}return function(e,n,i,r){var o,s,a,u,h,l="function"==typeof e&&e,p=!r&&Z(e=l.selector||e);if(i=i||[],1===p.length){if((s=p[0]=p[0].slice(0)).length>2&&"ID"===(a=s[0]).type&&9===n.nodeType&&c&&t.relative[s[1].type]){if(!(n=(t.find.ID(a.matches[0].replace(k,H),n)||[])[0]))return i;l&&(n=n.parentNode),e=e.slice(s.shift().value.length)}for(o=w.needsContext.test(e)?0:s.length;o--&&(a=s[o],!t.relative[u=a.type]);)if((h=t.find[u])&&(r=h(a.matches[0].replace(k,H),j.test(s[0].type)&&z(n.parentNode)||n))){if(s.splice(o,1),!(e=r.length&&ee(s)))return d.a.apply(i,r),i;break}}return(l||se(e,p))(r,n,!c,i,!n||j.test(e)&&z(n.parentNode)||n),i}(e.replace(O,"$1"),n,r,s)}function G(){var e=[];return function n(i,r){return e.push(i+" ")>t.cacheLength&&delete n[e.shift()],n[i+" "]=r}}function q(e){return e[f]=!0,e}function $(e){return function(t){return r(t,"input")&&t.type===e}}function W(e){return function(t){return(r(t,"input")||r(t,"button"))&&t.type===e}}function K(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&J(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function X(e){return q((function(t){return t=+t,q((function(n,i){for(var r,o=e([],n.length,t),s=o.length;s--;)n[r=o[s]]&&(n[r]=!(i[r]=n[r]))}))}))}function z(e){return e&&void 0!==e.getElementsByTagName&&e}function Y(e){var t,n=e?e.ownerDocument||e:v;n!=o&&9===n.nodeType&&(s=(o=n).documentElement,c=!i.a.isXMLDoc(o),l&&v!=o&&(t=o.defaultView)&&t.top!==t&&t.addEventListener("unload",U))}for(e in V.matches=function(e,t){return V(e,null,null,t)},V.matchesSelector=function(e,t){if(Y(e),c&&!T[t+" "]&&(!p||!p.test(t)))try{return S.call(e,t)}catch(e){T(t,!0)}return V(t,o,null,[e]).length>0},(t=i.a.expr={cacheLength:50,createPseudo:q,match:w,find:{ID:function(e,t){if(void 0!==t.getElementById&&c){var n=t.getElementById(e);return n?[n]:[]}},TAG:function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},CLASS:function(e,t){if(void 0!==t.getElementsByClassName&&c)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(k,H),e[3]=(e[3]||e[4]||e[5]||"").replace(k,H),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||B(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&B(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return w.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&P.test(n)&&(t=Z(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{ID:function(e){var t=e.replace(k,H);return function(e){return e.getAttribute("id")===t}},TAG:function(e){var t=e.replace(k,H).toLowerCase();return"*"===e?function(){return!0}:function(e){return r(e,t)}},CLASS:function(e){var t=g[e+" "];return t||(t=new RegExp("(^|"+h+")"+e+"("+h+"|$)"))&&g(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var o=i.a.attr(r,e);return null==o?"!="===t:!t||(o+="","="===t?o===n:"!="===t?o!==n:"^="===t?n&&0===o.indexOf(n):"*="===t?n&&o.indexOf(n)>-1:"$="===t?n&&o.slice(-n.length)===n:"~="===t?(" "+o.replace(N," ")+" ").indexOf(n)>-1:"|="===t&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,o){var s="nth"!==e.slice(0,3),a="last"!==e.slice(-4),c="of-type"===t;return 1===i&&0===o?function(e){return!!e.parentNode}:function(t,n,u){var d,h,l,p,_,g=s!==a?"nextSibling":"previousSibling",E=t.parentNode,v=c&&t.nodeName.toLowerCase(),S=!u&&!c,y=!1;if(E){if(s){for(;g;){for(l=t;l=l[g];)if(c?r(l,v):1===l.nodeType)return!1;_=g="only"===e&&!_&&"nextSibling"}return!0}if(_=[a?E.firstChild:E.lastChild],a&&S){for(y=(p=(d=(h=E[f]||(E[f]={}))[e]||[])[0]===m&&d[1])&&d[2],l=p&&E.childNodes[p];l=++p&&l&&l[g]||(y=p=0)||_.pop();)if(1===l.nodeType&&++y&&l===t){h[e]=[m,p,y];break}}else if(S&&(y=p=(d=(h=t[f]||(t[f]={}))[e]||[])[0]===m&&d[1]),!1===y)for(;(l=++p&&l&&l[g]||(y=p=0)||_.pop())&&(!(c?r(l,v):1===l.nodeType)||!++y||(S&&((h=l[f]||(l[f]={}))[e]=[m,y]),l!==t)););return(y-=o)===i||y%i==0&&y/i>=0}}},PSEUDO:function(e,n){var i,r=t.pseudos[e]||t.setFilters[e.toLowerCase()]||B("unsupported pseudo: "+e);return r[f]?r(n):r.length>1?(i=[e,e,"",n],t.setFilters.hasOwnProperty(e.toLowerCase())?q((function(e,t){for(var i,o=r(e,n),s=o.length;s--;)e[i=a.a.call(e,o[s])]=!(t[i]=o[s])})):function(e){return r(e,0,i)}):r}},pseudos:{not:q((function(e){var t=[],n=[],i=se(e.replace(O,"$1"));return i[f]?q((function(e,t,n,r){for(var o,s=i(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))})):function(e,r,o){return t[0]=e,i(t,null,o,n),t[0]=null,!n.pop()}})),has:q((function(e){return function(t){return V(e,t).length>0}})),contains:q((function(e){return e=e.replace(k,H),function(t){return(t.textContent||i.a.text(t)).indexOf(e)>-1}})),lang:q((function(e){return L.test(e||"")||B("unsupported lang: "+e),e=e.replace(k,H).toLowerCase(),function(t){var n;do{if(n=c?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=window.location&&window.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===s},focus:function(e){return e===o.activeElement&&o.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:K(!1),disabled:K(!0),checked:function(e){return r(e,"input")&&!!e.checked||r(e,"option")&&!!e.selected},selected:function(e){return l&&e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!t.pseudos.empty(e)},header:function(e){return x.test(e.nodeName)},input:function(e){return M.test(e.nodeName)},button:function(e){return r(e,"input")&&"button"===e.type||r(e,"button")},text:function(e){return r(e,"input")&&"text"===e.type},first:X((function(){return[0]})),last:X((function(e,t){return[t-1]})),eq:X((function(e,t,n){return[n<0?n+t:n]})),even:X((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:X((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:X((function(e,t,n){var i;for(i=n<0?n+t:n>t?t:n;--i>=0;)e.push(i);return e})),gt:X((function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e}))}}).pseudos.nth=t.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})t.pseudos[e]=$(e);for(e in{submit:!0,reset:!0})t.pseudos[e]=W(e);function Q(){}function Z(e,n){var i,r,o,s,a,c,u,d=E[e+" "];if(d)return n?0:d.slice(0);for(a=e,c=[],u=t.preFilter;a;){for(s in i&&!(r=I.exec(a))||(r&&(a=a.slice(r[0].length)||a),c.push(o=[])),i=!1,(r=R.exec(a))&&(i=r.shift(),o.push({value:i,type:r[0].replace(O," ")}),a=a.slice(i.length)),t.filter)!(r=w[s].exec(a))||u[s]&&!(r=u[s](r))||(i=r.shift(),o.push({value:i,type:s,matches:r}),a=a.slice(i.length));if(!i)break}return n?a.length:a?B(e):E(e,c).slice(0)}function ee(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function te(e,t,n){var i=t.dir,o=t.next,s=o||i,a=n&&"parentNode"===s,c=_++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||a)return e(t,n,r);return!1}:function(t,n,u){var d,h,l=[m,c];if(u){for(;t=t[i];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[i];)if(1===t.nodeType||a)if(h=t[f]||(t[f]={}),o&&r(t,o))t=t[i]||t;else{if((d=h[s])&&d[0]===m&&d[1]===c)return l[2]=d[2];if(h[s]=l,l[2]=e(t,n,u))return!0}return!1}}function ne(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function ie(e,t,n,i,r){for(var o,s=[],a=0,c=e.length,u=null!=t;a<c;a++)(o=e[a])&&(n&&!n(o,i,r)||(s.push(o),u&&t.push(a)));return s}function re(e,t,n,i,r,o){return i&&!i[f]&&(i=re(i)),r&&!r[f]&&(r=re(r,o)),q((function(o,s,c,u){var h,l,p,f,m=[],_=[],g=s.length,E=o||function(e,t,n){for(var i=0,r=t.length;i<r;i++)V(e,t[i],n);return n}(t||"*",c.nodeType?[c]:c,[]),v=!e||!o&&t?E:ie(E,m,e,c,u);if(n?n(v,f=r||(o?e:g||i)?[]:s,c,u):f=v,i)for(h=ie(f,_),i(h,[],c,u),l=h.length;l--;)(p=h[l])&&(f[_[l]]=!(v[_[l]]=p));if(o){if(r||e){if(r){for(h=[],l=f.length;l--;)(p=f[l])&&h.push(v[l]=p);r(null,f=[],h,u)}for(l=f.length;l--;)(p=f[l])&&(h=r?a.a.call(o,p):m[l])>-1&&(o[h]=!(s[h]=p))}}else f=ie(f===s?f.splice(g,f.length):f),r?r(null,s,f,u):d.a.apply(s,f)}))}function oe(e){for(var i,r,o,s=e.length,c=t.relative[e[0].type],u=c||t.relative[" "],d=c?1:0,h=te((function(e){return e===i}),u,!0),l=te((function(e){return a.a.call(i,e)>-1}),u,!0),p=[function(e,t,r){var o=!c&&(r||t!==n)||((i=t).nodeType?h(e,t,r):l(e,t,r));return i=null,o}];d<s;d++)if(r=t.relative[e[d].type])p=[te(ne(p),r)];else{if((r=t.filter[e[d].type].apply(null,e[d].matches))[f]){for(o=++d;o<s&&!t.relative[e[o].type];o++);return re(d>1&&ne(p),d>1&&ee(e.slice(0,d-1).concat({value:" "===e[d-2].type?"*":""})).replace(O,"$1"),r,d<o&&oe(e.slice(d,o)),o<s&&oe(e=e.slice(o)),o<s&&ee(e))}p.push(r)}return ne(p)}function se(e,r){var s,a=[],h=[],l=y[e+" "];if(!l){for(r||(r=Z(e)),s=r.length;s--;)(l=oe(r[s]))[f]?a.push(l):h.push(l);(l=y(e,function(e,r){var s=r.length>0,a=e.length>0,h=function(h,l,p,f,_){var g,E,v,S=0,y="0",T=h&&[],b=[],C=n,A=h||a&&t.find.TAG("*",_),N=m+=null==C?1:Math.random()||.1;for(_&&(n=l==o||l||_);null!=(g=A[y]);y++){if(a&&g){for(E=0,l||g.ownerDocument==o||(Y(g),p=!c);v=e[E++];)if(v(g,l||o,p)){d.a.call(f,g);break}_&&(m=N)}s&&((g=!v&&g)&&S--,h&&T.push(g))}if(S+=y,s&&y!==S){for(E=0;v=r[E++];)v(T,b,l,p);if(h){if(S>0)for(;y--;)T[y]||b[y]||(b[y]=u.call(f));b=ie(b)}d.a.apply(f,b),_&&!h&&b.length>0&&S+r.length>1&&i.a.uniqueSort(f)}return _&&(m=N,n=C),T};return s?q(h):h}(h,a))).selector=e}return l}Q.prototype=t.filters=t.pseudos,t.setFilters=new Q,Y(),i.a.find=V}();var y=n(32),T=function(e,t,n,r,o,s,a){let c=0,u=e.length,d=null==n;if("object"===Object(y.a)(n))for(c in o=!0,n)T(e,t,c,n[c],!0,s,a);else if(void 0!==r&&(o=!0,"function"!=typeof r&&(a=!0),d&&(a?(t.call(e,r),t=null):(d=t,t=function(e,t,n){return d.call(Object(i.a)(e),n)})),t))for(;c<u;c++)t(e[c],n,a?r:r.call(e[c],c,t(e[c],n)));return o?e:d?t.call(e):u?t(e[0],n):s},b=T,C=/[^\x20\t\r\n\f]+/g;i.a.fn.extend({attr:function(e,t){return b(this,i.a.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){i.a.removeAttr(this,e)}))}}),i.a.extend({attr:function(e,t,n){var r,o,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?i.a.prop(e,t,n):(1===s&&i.a.isXMLDoc(e)||(o=i.a.attrHooks[t.toLowerCase()]),void 0!==n?null===n?void i.a.removeAttr(e,t):o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:(e.setAttribute(t,n+""),n):o&&"get"in o&&null!==(r=o.get(e,t))?r:null==(r=e.getAttribute(t))?void 0:r)},attrHooks:{},removeAttr:function(e,t){var n,i=0,r=t&&t.match(C);if(r&&1===e.nodeType)for(;n=r[i++];)e.removeAttribute(n)}}),l&&(i.a.attrHooks.type={set:function(e,t){if("radio"===t&&r(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}),i.a.each(i.a.expr.match.bool.source.match(/\w+/g),(function(e,t){i.a.attrHooks[t]={get:function(e){var n,r=i.a.isXMLDoc(e),o=t.toLowerCase();return r||(n=null!=e.getAttribute(t)?o:null),n},set:function(e,t,n){return!1===t?i.a.removeAttr(e,n):e.setAttribute(n,n),n}}}));var A=/^(?:input|select|textarea|button)$/i,N=/^(?:a|area)$/i;i.a.fn.extend({prop:function(e,t){return b(this,i.a.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[i.a.propFix[e]||e]}))}}),i.a.extend({prop:function(e,t,n){var r,o,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&i.a.isXMLDoc(e)||(t=i.a.propFix[t]||t,o=i.a.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:e[t]=n:o&&"get"in o&&null!==(r=o.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=e.getAttribute("tabindex");return t?parseInt(t,10):A.test(e.nodeName)||N.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),l&&(i.a.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),i.a.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){i.a.propFix[this.toLowerCase()]=this}));var O=function(e){return(e.match(C)||[]).join(" ")},I=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,R=i.a.expr.match.needsContext;function D(e,t,n){return"function"==typeof t?i.a.grep(e,(function(e,i){return!!t.call(e,i,e)!==n})):t.nodeType?i.a.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?i.a.grep(e,(function(e){return a.a.call(t,e)>-1!==n})):i.a.filter(t,e,n)}i.a.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?i.a.find.matchesSelector(r,e)?[r]:[]:i.a.find.matches(e,i.a.grep(t,(function(e){return 1===e.nodeType})))},i.a.fn.extend({find:function(e){var t,n,r=this.length,o=this;if("string"!=typeof e)return this.pushStack(Object(i.a)(e).filter((function(){for(t=0;t<r;t++)if(i.a.contains(o[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)i.a.find(e,o[t],n);return r>1?i.a.uniqueSort(n):n},filter:function(e){return this.pushStack(D(this,e||[],!1))},not:function(e){return this.pushStack(D(this,e||[],!0))},is:function(e){return!!D(this,"string"==typeof e&&R.test(e)?Object(i.a)(e):e||[],!1).length}});let P,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;function w(e){return e.getAttribute&&e.getAttribute("class")||""}function M(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(C)||[]}(i.a.fn.init=function(e,t,n){let r,s;if(!e)return this;if(n=n||P,"string"==typeof e){if(s="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:L.exec(e),s&&(s[1]||!t)){if(s[1]){if(t=t instanceof i.a?t[0]:t,i.a.merge(this,i.a.parseHTML(s[1],t&&t.nodeType?t.ownerDocument||t:o.a,!0)),I.test(s[1])&&i.a.isPlainObject(t))for(s in t)"function"==typeof this[s]?this[s](t[s]):this.attr(s,t[s]);return this}return r=o.a.getElementById(s[2]),r&&(this[0]=r,this.length=1),this}return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e)}return e.nodeType?(this[0]=e,this.length=1,this):"function"==typeof e?void 0!==n.ready?n.ready(e):e(i.a):i.a.makeArray(e,this)}).prototype=i.a.fn,P=Object(i.a)(o.a),i.a.fn.extend({addClass:function(e){var t,n,r,o,s,a,c,u=0;if("function"==typeof e)return this.each((function(t){Object(i.a)(this).addClass(e.call(this,t,w(this)))}));if((t=M(e)).length)for(;n=this[u++];)if(o=w(n),r=1===n.nodeType&&" "+O(o)+" "){for(a=0;s=t[a++];)r.indexOf(" "+s+" ")<0&&(r+=s+" ");o!==(c=O(r))&&n.setAttribute("class",c)}return this},removeClass:function(e){var t,n,r,o,s,a,c,u=0;if("function"==typeof e)return this.each((function(t){Object(i.a)(this).removeClass(e.call(this,t,w(this)))}));if(!arguments.length)return this.attr("class","");if((t=M(e)).length)for(;n=this[u++];)if(o=w(n),r=1===n.nodeType&&" "+O(o)+" "){for(a=0;s=t[a++];)for(;r.indexOf(" "+s+" ")>-1;)r=r.replace(" "+s+" "," ");o!==(c=O(r))&&n.setAttribute("class",c)}return this},toggleClass:function(e,t){return"function"==typeof e?this.each((function(n){Object(i.a)(this).toggleClass(e.call(this,n,w(this),t),t)})):"boolean"==typeof t?t?this.addClass(e):this.removeClass(e):this.each((function(){var t,n,r,o;for(n=0,r=Object(i.a)(this),o=M(e);t=o[n++];)r.hasClass(t)?r.removeClass(t):r.addClass(t)}))},hasClass:function(e){var t,n,i=0;for(t=" "+e+" ";n=this[i++];)if(1===n.nodeType&&(" "+O(w(n))+" ").indexOf(t)>-1)return!0;return!1}}),i.a.fn.extend({val:function(e){var t,n,r,o=this[0];return arguments.length?(r="function"==typeof e,this.each((function(n){var o;1===this.nodeType&&(null==(o=r?e.call(this,n,Object(i.a)(this).val()):e)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=i.a.map(o,(function(e){return null==e?"":e+""}))),(t=i.a.valHooks[this.type]||i.a.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))}))):o?(t=i.a.valHooks[o.type]||i.a.valHooks[o.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:null==(n=o.value)?"":n:void 0}}),i.a.extend({valHooks:{select:{get:function(e){var t,n,o,s=e.options,a=e.selectedIndex,c="select-one"===e.type,u=c?null:[],d=c?a+1:s.length;for(o=a<0?d:c?a:0;o<d;o++)if((n=s[o]).selected&&!n.disabled&&(!n.parentNode.disabled||!r(n.parentNode,"optgroup"))){if(t=Object(i.a)(n).val(),c)return t;u.push(t)}return u},set:function(e,t){for(var n,r,o=e.options,s=i.a.makeArray(t),a=o.length;a--;)((r=o[a]).selected=i.a.inArray(Object(i.a)(r).val(),s)>-1)&&(n=!0);return n||(e.selectedIndex=-1),s}}}}),l&&(i.a.valHooks.option={get:function(e){var t=e.getAttribute("value");return null!=t?t:O(i.a.text(e))}}),i.a.each(["radio","checkbox"],(function(){i.a.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=i.a.inArray(Object(i.a)(e).val(),t)>-1}}}));i.a;i.a.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new window.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||i.a.error("Invalid XML: "+e),t};n(92);i.a.fn.extend({text:function(e){return b(this,(function(e){return void 0===e?i.a.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)}});i.a,t.default=i.a},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){var n={trace:0,debug:1,info:2,log:3,warn:4,error:5};a.consoleTransport=console;var i=[a.consoleTransport];a.addGlobalTransport=function(e){-1===i.indexOf(e)&&i.push(e)},a.removeGlobalTransport=function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1)};var r={};function o(){var e={methodName:"",fileLocation:"",line:null,column:null},t=new Error,n=t.stack?t.stack.split("\n"):[];if(!n||n.length<3)return e;var i=null;return n[3]&&(i=n[3].match(/\s*at\s*(.+?)\s*\((\S*)\s*:(\d*)\s*:(\d*)\)/)),!i||i.length<=4?(0===n[2].indexOf("log@")?e.methodName=n[3].substr(0,n[3].indexOf("@")):e.methodName=n[2].substr(0,n[2].indexOf("@")),e):(e.methodName=i[1],e.fileLocation=i[2],e.line=i[3],e.column=i[4],e)}function s(){var e=arguments[0],t=arguments[1],s=Array.prototype.slice.call(arguments,2);if(!(n[t]<e.level))for(var a=!(e.options.disableCallerInfo||r.disableCallerInfo)&&o(),c=i.concat(e.transports),u=0;u<c.length;u++){var d=c[u],h=d[t];if(h&&"function"==typeof h){var l=[];l.push((new Date).toISOString()),e.id&&l.push("["+e.id+"]"),a&&a.methodName.length>1&&l.push("<"+a.methodName+">: ");var p=l.concat(s);h.bind(d).apply(d,p)}}}function a(e,t,i,r){this.id=t,this.options=r||{},this.transports=i,this.transports||(this.transports=[]),this.level=n[e];for(var o=Object.keys(n),a=0;a<o.length;a++)this[o[a]]=s.bind(null,this,o[a])}a.setGlobalOptions=function(e){r=e||{}},a.prototype.setLevel=function(e){this.level=n[e]},e.exports=a,a.levels={TRACE:"trace",DEBUG:"debug",INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n(47),r=n(10),o=n(3),s=n.n(o),a=n(17),c=n(6),u=n(27);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){t=!t||{},t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){d(e,t,n[t])}))}return e}({},u.b,t),this.token=e;const n=this.parseJwt(e);this.name=n?n.room:null,this.user=n.context.user,this.options=t,this.xmpp=new a.d(t,e,this.name),this.addEventListener(r.CONNECTION_FAILED,(e,t,n,i)=>{s.a.sendAnalyticsAndLog(Object(c.createConnectionFailedEvent)(e,t,i))}),this.addEventListener(r.CONNECTION_DISCONNECTED,e=>{e&&s.a.sendAnalytics(c.CONNECTION_DISCONNECTED,{message:e}),s.a.sendLog(JSON.stringify({id:c.CONNECTION_DISCONNECTED,msg:e}))})}h.prototype.parseJwt=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}},h.prototype.connect=function(e={}){this.xmpp.connect(e.id,e.password)},h.prototype.attach=function(e){this.xmpp.attach(e)},h.prototype.disconnect=function(...e){return this.xmpp.disconnect(...e)},h.prototype.getJid=function(){return this.xmpp.getJid()},h.prototype.setToken=function(e){this.token=e},h.prototype.initJitsiConference=function(e){return new i.a({name:this.name,config:e,connection:this,user:this.user})},h.prototype.addEventListener=function(e,t){this.xmpp.addListener(e,t)},h.prototype.removeEventListener=function(e,t){this.xmpp.removeListener(e,t)},h.prototype.getConnectionTimes=function(){return this.xmpp.connectionTimes},h.prototype.addFeature=function(e,t=!1){this.xmpp.caps.addFeature(e,t,!0)},h.prototype.removeFeature=function(e,t=!1){this.xmpp.caps.removeFeature(e,t,!0)},h.prototype.getLogs=function(){const e=this.xmpp.getJingleLog(),t={};t.time=new Date,t.url=window.location.href,t.ua=navigator.userAgent;const n=this.xmpp.getXmppLog();return n&&(t.xmpp=n),e.metadata=t,e}},function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return Ne}));var r=n(33),o=n.n(r),s=n(15),a=n(48),c=n.n(a),u=n(5),d=n(7),h=n(49),l=n(1),p=n(52),f=n(28),m=n(8),_=n(18),g=n(53),E=n(59),v=n(9),S=n.n(v),y=n(13),T=n.n(y),b=n(60),C=n.n(b),A=n(61),N=n.n(A),O=n(26),I=n.n(O),R=n(24),D=n(62),P=n.n(D),L=n(63),w=n.n(L),M=n(44),x=n.n(M),F=n(64),j=n.n(F),k=n(65),H=n.n(k),U=n(29),J=n(66),B=n.n(J),V=n(67),G=n.n(V),q=n(68),$=n(69),W=n(70),K=n.n(W),X=n(35),z=n.n(X),Y=n(71),Q=n.n(Y),Z=n(72),ee=n.n(Z),te=n(73),ne=n.n(te),ie=n(3),re=n.n(ie),oe=n(74),se=n.n(oe),ae=n(20),ce=n.n(ae),ue=(n(41),n(75)),de=n.n(ue),he=n(76),le=n.n(he),pe=n(36),fe=n(17),me=n(30),_e=n.n(me),ge=n(4),Ee=n(23),ve=n.n(Ee),Se=n(6),ye=n(2),Te=n(27);function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){Ce(e,t,n[t])}))}return e}function Ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ae=Object(s.getLogger)(e);function Ne(e){if(e=!e||{},!(e=be({},Te.a,e)).name||e.name.toLowerCase()!==e.name){const e="Invalid conference name (no conference name passed or it contains invalid characters like capital letters)!";throw Ae.error(e),new Error(e)}this.user=e.user,this.eventEmitter=new o.a,this.options=e,this.eventManager=new h.a(this),this.participants={},this._init(e),this.componentsVersions=new de.a(this),this.jvbJingleSession=null,this.lastDominantSpeaker=null,this.dtmfManager=null,this.somebodySupportsDTMF=!1,this.authEnabled=!1,this.startAudioMuted=!1,this.startVideoMuted=!1,this.startMutedPolicy={audio:!1,video:!1},this.isMutedByFocus=!1,this.mutedByFocusActor=null,this.isVideoMutedByFocus=!1,this.mutedVideoByFocusActor=null,this.wasStopped=!1,this.properties={},this.connectionQuality=new C.a(this,this.eventEmitter,e),this.avgRtpStatsReporter=new ee.a(this,e.config.avgRtpStatsN||15),this._audioOutputProblemDetector=new Q.a(this),this.isJvbConnectionInterrupted=!1,this.speakerStatsCollector=new ne.a(this),this.deferredStartP2PTask=null;const t=parseInt(e.config.p2p&&e.config.p2p.backToP2PDelay,10);this.backToP2PDelay=isNaN(t)?5:t,Ae.info("backToP2PDelay: "+this.backToP2PDelay),this.isP2PConnectionInterrupted=!1,this.p2p=!1,this.p2pJingleSession=null,this.videoSIPGWHandler=new le.a(this.room),this.recordingManager=new K.a(this.room),this._conferenceJoinAnalyticsEventSent=void 0,this.isE2EESupported()&&(Ae.info("End-to-End Encryprtion is supported"),this._e2eEncryption=new U.E2EEncryption(this))}Ne.prototype.constructor=Ne,Ne.resourceCreator=function(e){return u.Strophe.getNodeFromJid(e)},Ne.prototype._init=function(e={}){e.connection&&(this.connection=e.connection,this.xmpp=this.connection.xmpp,this.eventManager.setupXMPPListeners());const{config:t}=this.options,n={disabledCodec:t.videoQuality?t.videoQuality.disabledCodec:t.p2p&&t.p2p.disableH264&&_e.a.H264,enforcePreferredCodec:t.videoQuality&&t.videoQuality.enforcePreferredCodec,jvbCodec:t.videoQuality&&t.videoQuality.preferredCodec||t.preferH264&&_e.a.H264,p2pCodec:t.p2p?t.p2p.preferredCodec||t.p2p.preferH264&&_e.a.H264:_e.a.VP8};this.codecSelection=new E.CodecSelection(this,n),this._statsCurrentId=t.statisticsId?t.statisticsId:z.a.callStatsUserName,this.room=this.xmpp.createRoom(this.options.name,be({},t,{statsId:this._statsCurrentId}),Ne.resourceCreator),this._onIceConnectionInterrupted=this._onIceConnectionInterrupted.bind(this),this.room.addListener(ye.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),this._onIceConnectionRestored=this._onIceConnectionRestored.bind(this),this.room.addListener(ye.CONNECTION_RESTORED,this._onIceConnectionRestored),this._onIceConnectionEstablished=this._onIceConnectionEstablished.bind(this),this.room.addListener(ye.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this._updateProperties=this._updateProperties.bind(this),this.room.addListener(ye.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),this._sendConferenceJoinAnalyticsEvent=this._sendConferenceJoinAnalyticsEvent.bind(this),this.room.addListener(ye.MEETING_ID_SET,this._sendConferenceJoinAnalyticsEvent),this.e2eping=new B.a(this,t,(e,t)=>{try{this.sendMessage(e,t,!0)}catch(e){Ae.warn("Failed to send E2E ping request or response.",e&&e.msg)}}),this.rtc||(this.rtc=new S.a(this,e),this.eventManager.setupRTCListeners()),this.receiveVideoController=new q.ReceiveVideoController(this,this.rtc),this.sendVideoController=new $.SendVideoController(this,this.rtc),this.participantConnectionStatus=new I.a(this.rtc,this,{rtcMuteTimeout:t._peerConnStatusRtcMuteTimeout,outOfLastNTimeout:t._peerConnStatusOutOfLastNTimeout}),this.participantConnectionStatus.init();let i=!0;if(t.testing&&t.testing.callStatsThreshold&&(i=100*Math.random()<=t.testing.callStatsThreshold),this.statistics||(this.statistics=new re.a(this.xmpp,{aliasName:this._statsCurrentId,userName:t.statisticsDisplayName?t.statisticsDisplayName:this.myUserId(),confID:t.confID||`${this.connection.options.hosts.domain}/${this.options.name}`,siteID:t.siteID,customScriptUrl:t.callStatsCustomScriptUrl,callStatsID:t.callStatsID,callStatsSecret:t.callStatsSecret,callStatsApplicationLogsDisabled:t.callStatsApplicationLogsDisabled,enableCallStats:i,roomName:this.options.name,applicationName:t.applicationName,getWiFiStatsMethod:t.getWiFiStatsMethod}),re.a.analytics.addPermanentProperties({callstats_name:this._statsCurrentId}),t.longTasksStatsInterval&&this.statistics.attachLongTasksStats(this)),this.eventManager.setupChatRoomListeners(),this.eventManager.setupStatisticsListeners(),t.enableTalkWhileMuted&&T.a.supportsVADDetection())if(t.createVADProcessor){Ae.info("Using VAD detection for generating talk while muted events"),this._audioAnalyser||(this._audioAnalyser=new x.a(this,t.createVADProcessor));const e=new H.a;e.on(R.VAD_TALK_WHILE_MUTED,()=>this.eventEmitter.emit(l.TALK_WHILE_MUTED)),this._audioAnalyser.addVADDetectionService(e)}else Ae.warn("No VAD Processor was provided. Talk while muted detection service was not initialized!");if(t.enableNoisyMicDetection&&T.a.supportsVADDetection())if(t.createVADProcessor){this._audioAnalyser||(this._audioAnalyser=new x.a(this,t.createVADProcessor));const e=new j.a;e.on(R.VAD_NOISY_DEVICE,()=>this.eventEmitter.emit(l.NOISY_MIC)),this._audioAnalyser.addVADDetectionService(e)}else Ae.warn("No VAD Processor was provided. Noisy microphone detection service was not initialized!");t.enableNoAudioDetection&&(this._noAudioSignalDetection=new P.a(this),this._noAudioSignalDetection.on(R.NO_AUDIO_INPUT,()=>{this.eventEmitter.emit(l.NO_AUDIO_INPUT)}),this._noAudioSignalDetection.on(R.AUDIO_INPUT_STATE_CHANGE,e=>{this.eventEmitter.emit(l.AUDIO_INPUT_STATE_CHANGE,e)})),"channelLastN"in t&&this.setLastN(t.channelLastN),this.jvb121Status=new G.a(this),this.p2pDominantSpeakerDetection=new w.a(this),t&&t.deploymentInfo&&t.deploymentInfo.userRegion&&this.setLocalParticipantProperty("region",t.deploymentInfo.userRegion),this.setLocalParticipantProperty("codecType",this.codecSelection.getPreferredCodec())},Ne.prototype.join=function(e){this.room&&this.room.join(e).then(()=>this._maybeSetSITimeout())},Ne.prototype.authenticateAndUpgradeRole=function(e){return g.a.call(this,be({},e,{onCreateResource:Ne.resourceCreator}))},Ne.prototype.isJoined=function(){return this.room&&this.room.joined},Ne.prototype.isP2PEnabled=function(){return Boolean(this.options.config.p2p&&this.options.config.p2p.enabled)||void 0===this.options.config.p2p},Ne.prototype.isP2PTestModeEnabled=function(){return Boolean(this.options.config.testing&&this.options.config.testing.p2pTestMode)},Ne.prototype.leave=function(){if(this.participantConnectionStatus&&(this.participantConnectionStatus.dispose(),this.participantConnectionStatus=null),this.avgRtpStatsReporter&&(this.avgRtpStatsReporter.dispose(),this.avgRtpStatsReporter=null),this._audioOutputProblemDetector&&(this._audioOutputProblemDetector.dispose(),this._audioOutputProblemDetector=null),this.e2eping&&(this.e2eping.stop(),this.e2eping=null),this.getLocalTracks().forEach(e=>this.onLocalTrackRemoved(e)),this.rtc.closeBridgeChannel(),this._sendConferenceLeftAnalyticsEvent(),this.statistics&&this.statistics.dispose(),this._delayedIceFailed&&this._delayedIceFailed.cancel(),this.jvbJingleSession&&(this.jvbJingleSession.close(),this.jvbJingleSession=null),this.p2pJingleSession&&(this.p2pJingleSession.close(),this.p2pJingleSession=null),this.room){const e=this.room;return e.removeListener(ye.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),e.removeListener(ye.CONNECTION_RESTORED,this._onIceConnectionRestored),e.removeListener(ye.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),e.removeListener(ye.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),e.removeListener(ye.MEETING_ID_SET,this._sendConferenceJoinAnalyticsEvent),this.eventManager.removeXMPPListeners(),this.room=null,e.leave().then(()=>{this.rtc&&this.rtc.destroy()}).catch(e=>{throw this.getParticipants().forEach(e=>this.onMemberLeft(e.getJid())),e})}return Promise.reject(new Error("The conference is has been already left"))},Ne.prototype._getActiveMediaSession=function(){return this.isP2PActive()?this.p2pJingleSession:this.jvbJingleSession},Ne.prototype._getMediaSessions=function(){const e=[];return this.jvbJingleSession&&e.push(this.jvbJingleSession),this.p2pJingleSession&&e.push(this.p2pJingleSession),e},Ne.prototype.getName=function(){return this.options.name},Ne.prototype.getConnection=function(){return this.connection},Ne.prototype.isAuthEnabled=function(){return this.authEnabled},Ne.prototype.isLoggedIn=function(){return Boolean(this.authIdentity)},Ne.prototype.getAuthLogin=function(){return this.authIdentity},Ne.prototype.isExternalAuthEnabled=function(){return this.room&&this.room.moderator.isExternalAuthEnabled()},Ne.prototype.getExternalAuthUrl=function(e){return new Promise((t,n)=>{this.isExternalAuthEnabled()?e?this.room.moderator.getPopupLoginUrl(t,n):this.room.moderator.getLoginUrl(t,n):n()})},Ne.prototype.getLocalTracks=function(e){let t=[];return this.rtc&&(t=this.rtc.getLocalTracks(e)),t},Ne.prototype.getLocalAudioTrack=function(){return this.rtc?this.rtc.getLocalAudioTrack():null},Ne.prototype.getLocalVideoTrack=function(){return this.rtc?this.rtc.getLocalVideoTrack():null},Ne.prototype.getPerformanceStats=function(){return{longTasksStats:this.statistics.getLongTasksStats()}},Ne.prototype.on=function(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)},Ne.prototype.off=function(e,t){this.eventEmitter&&this.eventEmitter.removeListener(e,t)},Ne.prototype.addEventListener=Ne.prototype.on,Ne.prototype.removeEventListener=Ne.prototype.off,Ne.prototype.addCommandListener=function(e,t){this.room&&this.room.addPresenceListener(e,t)},Ne.prototype.removeCommandListener=function(e,t){this.room&&this.room.removePresenceListener(e,t)},Ne.prototype.sendTextMessage=function(e,t="body"){this.room&&this.room.sendMessage(e,t)},Ne.prototype.sendPrivateTextMessage=function(e,t,n="body"){this.room&&this.room.sendPrivateMessage(e,t,n)},Ne.prototype.sendCommand=function(e,t){this.room?this.room.addOrReplaceInPresence(e,t)&&this.room.sendPresence():Ae.warn("Not sending a command, room not initialized.")},Ne.prototype.sendCommandOnce=function(e,t){this.sendCommand(e,t),this.removeCommand(e)},Ne.prototype.removeCommand=function(e){this.room&&this.room.removeFromPresence(e)},Ne.prototype.setDisplayName=function(e){this.room&&this.room.addOrReplaceInPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e})&&this.room.sendPresence()},Ne.prototype.setSubject=function(e){this.room&&this.isModerator()?this.room.setSubject(e):Ae.warn(`Failed to set subject, ${this.room?"":"not in a room, "}${this.isModerator()?"":"participant is not a moderator"}`)},Ne.prototype.getTranscriber=function(){if(void 0===this.transcriber){this.transcriber=new se.a;const e=this.getLocalTracks(ge.AUDIO);for(const t of e)this.transcriber.addTrack(t);const t=this.rtc.getRemoteTracks(ge.AUDIO);for(const e of t)this.transcriber.addTrack(e)}return this.transcriber},Ne.prototype.getTranscriptionStatus=function(){return this.room.transcriptionStatus},Ne.prototype.addTrack=function(e){const t=e.getType(),n=this.rtc.getLocalTracks(t);return n.length>0?e===n[0]?Promise.resolve(e):Promise.reject(new Error(`Cannot add second ${t} track to the conference`)):this.replaceTrack(null,e)},Ne.prototype._fireAudioLevelChangeEvent=function(e,t){const n=this.getActivePeerConnection();t&&n!==t||this.eventEmitter.emit(l.TRACK_AUDIO_LEVEL_CHANGED,this.myUserId(),e)},Ne.prototype._fireMuteChangeEvent=function(e){let t;if(this.isMutedByFocus&&e.isAudioTrack()&&!e.isMuted()?(this.isMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1,ge.AUDIO)):this.isVideoMutedByFocus&&e.isVideoTrack()&&!e.isMuted()&&(this.isVideoMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1,ge.VIDEO)),this.mutedByFocusActor&&e.isAudioTrack()){const e=u.Strophe.getResourceFromJid(this.mutedByFocusActor);t=this.participants[e]}else if(this.mutedVideoByFocusActor&&e.isVideoTrack()){const e=u.Strophe.getResourceFromJid(this.mutedVideoByFocusActor);t=this.participants[e]}this.eventEmitter.emit(l.TRACK_MUTE_CHANGED,e,t)},Ne.prototype._getInitialLocalTracks=function(){return this.getLocalTracks().filter(e=>e.getType()===ge.AUDIO&&!this.isStartAudioMuted()||e.getType()===ge.VIDEO&&!this.isStartVideoMuted())},Ne.prototype.onLocalTrackRemoved=function(e){e._setConference(null),this.rtc.removeLocalTrack(e),e.removeEventListener(_.TRACK_MUTE_CHANGED,e.muteHandler),e.removeEventListener(_.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e.isVideoTrack()&&e.videoType===ve.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!1),this.eventEmitter.emit(l.TRACK_REMOVED,e)},Ne.prototype.removeTrack=function(e){return this.replaceTrack(e,null)},Ne.prototype.replaceTrack=function(e,t){return e&&e.disposed||t&&t.disposed?Promise.reject(new f.a(m.TRACK_IS_DISPOSED)):this._doReplaceTrack(e,t).then(()=>(e&&this.onLocalTrackRemoved(e),t?(this._setupNewTrack(t),t.isVideoTrack()&&this.rtc.setVideoType(t.videoType)):e&&e.isVideoTrack()&&this.rtc.setVideoType(ve.a.NONE),(this.isMutedByFocus||this.isVideoMutedByFocus)&&this._fireMuteChangeEvent(t),Promise.resolve())).catch(e=>Promise.reject(new Error(e)))},Ne.prototype._doReplaceTrack=function(e,t){const n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.replaceTrack(e,t)):Ae.info("_doReplaceTrack - no JVB JingleSession"),this.p2pJingleSession?n.push(this.p2pJingleSession.replaceTrack(e,t)):Ae.info("_doReplaceTrack - no P2P JingleSession"),Promise.all(n)},Ne.prototype._setupNewTrack=function(e){if(e.isAudioTrack()||e.isVideoTrack()&&e.videoType!==ve.a.DESKTOP){const t=S.a.getCurrentlyAvailableMediaDevices().find(t=>t.kind===e.getTrack().kind+"input"&&t.label===e.getTrack().label);t&&re.a.sendActiveDeviceListEvent(S.a.getEventDataForActiveDevice(t))}if(e.isVideoTrack()){const t="videoType";(e.videoType!==ve.a.CAMERA||this.room.getFromPresence(t))&&this.sendCommand(t,{value:e.videoType})}this.rtc.addLocalTrack(e),e.isAudioTrack()?this.room.setAudioMute(e.isMuted()):this.room.setVideoMute(e.isMuted()),e.muteHandler=this._fireMuteChangeEvent.bind(this,e),e.audioLevelHandler=this._fireAudioLevelChangeEvent.bind(this),e.addEventListener(_.TRACK_MUTE_CHANGED,e.muteHandler),e.addEventListener(_.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e._setConference(this),this.eventEmitter.emit(l.TRACK_ADDED,e)},Ne.prototype._addLocalTrackAsUnmute=function(e){const t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.addTrackAsUnmute(e)):Ae.debug("Add local MediaStream as unmute - no JVB Jingle session started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.addTrackAsUnmute(e)):Ae.debug("Add local MediaStream as unmute - no P2P Jingle session started yet"),Promise.allSettled(t).then(()=>{e.isVideoTrack()&&this.rtc.setVideoType(e.videoType)})},Ne.prototype._removeLocalTrackAsMute=function(e){const t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.removeTrackAsMute(e)):Ae.debug("Remove local MediaStream - no JVB JingleSession started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.removeTrackAsMute(e)):Ae.debug("Remove local MediaStream - no P2P JingleSession started yet"),Promise.allSettled(t).then(()=>{e.isVideoTrack()&&this.rtc.setVideoType(ve.a.NONE)})},Ne.prototype.getRole=function(){return this.room.role},Ne.prototype.isHidden=function(){return this.connection?u.Strophe.getDomainFromJid(this.connection.getJid())===this.options.config.hiddenDomain:null},Ne.prototype.isModerator=function(){return this.room?this.room.isModerator():null},Ne.prototype.lock=function(e){return this.isModerator()?new Promise((t,n)=>{this.room.lockRoom(e||"",()=>t(),e=>n(e),()=>n(d.PASSWORD_NOT_SUPPORTED))}):Promise.reject(new Error("You are not moderator."))},Ne.prototype.unlock=function(){return this.lock()},Ne.prototype.selectParticipant=function(e){this.selectParticipants([e])},Ne.prototype.selectParticipants=function(e){if(!Array.isArray(e))throw new Error("Invalid argument; participantIds must be an array.");this.receiveVideoController.selectEndpoints(e)},Ne.prototype.getLastN=function(){return this.receiveVideoController.getLastN()},Ne.prototype.setLastN=function(e){if(!Number.isInteger(e)&&!Number.parseInt(e,10))throw new Error("Invalid value for lastN: "+e);const t=Number(e);if(t<-1)throw new RangeError("lastN cannot be smaller than -1");if(this.receiveVideoController.setLastN(t),this.p2pJingleSession){const e=0!==t;this.p2pJingleSession.setMediaTransferActive(!0,e).catch(t=>{Ae.error(`Failed to adjust video transfer status (${e})`,t)})}},Ne.prototype.isInLastN=function(e){return this.rtc.isInLastN(e)},Ne.prototype.getParticipants=function(){return Object.values(this.participants)},Ne.prototype.getParticipantCount=function(e=!1){let t=this.getParticipants();return e||(t=t.filter(e=>!e.isHidden())),t.length+1},Ne.prototype.getParticipantById=function(e){return this.participants[e]},Ne.prototype.grantOwner=function(e){const t=this.getParticipantById(e);t&&this.room.setAffiliation(t.getJid(),"owner")},Ne.prototype.revokeOwner=function(e){const t=this.getParticipantById(e),n=this.myUserId()===e,i=this.isMembersOnly()?"member":"none";n?this.room.setAffiliation(this.room.myroomjid,i):t&&this.room.setAffiliation(t.getJid(),i)},Ne.prototype.kickParticipant=function(e,t){const n=this.getParticipantById(e);n&&this.room.kick(n.getJid(),t)},Ne.prototype._maybeClearSITimeout=function(){this._sessionInitiateTimeout&&(this.jvbJingleSession||this.getParticipantCount()<2)&&(window.clearTimeout(this._sessionInitiateTimeout),this._sessionInitiateTimeout=null)},Ne.prototype._maybeSetSITimeout=function(){!this.jvbJingleSession&&this.getParticipantCount()>=2&&!this._sessionInitiateTimeout&&(this._sessionInitiateTimeout=window.setTimeout(()=>{this._sessionInitiateTimeout=null,re.a.sendAnalytics(Object(Se.createJingleEvent)(Se.ACTION_JINGLE_SI_TIMEOUT,{p2p:!1,value:5e3}))},5e3))},Ne.prototype.muteParticipant=function(e,t){const n=t||ge.AUDIO;if(n!==ge.AUDIO&&n!==ge.VIDEO)return void Ae.error("Unsupported media type: "+n);const i=this.getParticipantById(e);i&&this.room.muteParticipant(i.getJid(),!0,n)},Ne.prototype.onMemberJoined=function(e,t,n,i,r,o,s,a,c,d){const h=u.Strophe.getResourceFromJid(e);if("focus"===h||this.myUserId()===h)return;const f=new p.a(e,this,t,i,r,o,s);f.setRole(n),f.setBotType(a),f.setFeatures(d),this.participants[h]=f,this.eventEmitter.emit(l.USER_JOINED,h,f),this._updateFeatures(f),this.isJoined()&&this._maybeStartOrStopP2P(),this._maybeSetSITimeout()},Ne.prototype._onMucJoined=function(){this._maybeStartOrStopP2P()},Ne.prototype._updateFeatures=function(e){e.getFeatures().then(t=>{e._supportsDTMF=t.has("urn:xmpp:jingle:dtmf:0"),this.updateDTMFSupport(),t.has(fe.b)&&e.setProperty("features_jigasi",!0),t.has(fe.a)&&e.setProperty("features_e2ee",!0)}).catch(()=>!1)},Ne.prototype._onMemberBotTypeChanged=function(e,t){const n=this.getParticipants().find(t=>t.getJid()===e);if(n){n.setBotType(t);const i=u.Strophe.getResourceFromJid(e);this.eventEmitter.emit(l.BOT_TYPE_CHANGED,i,t)}n.getBotType()||this._maybeStartOrStopP2P()},Ne.prototype.onMemberLeft=function(e){const t=u.Strophe.getResourceFromJid(e);if("focus"===t||this.myUserId()===t)return;const n=this.participants[t];delete this.participants[t];const i=this._getMediaSessions(),r=[];for(const e of i)r.push(e.removeRemoteStreamsOnLeave(t));Promise.allSettled(r).then(e=>{let i=[];e.map(e=>e.value).forEach(e=>{e&&(i=i.concat(e))}),i.forEach(e=>{this.eventEmitter.emit(l.TRACK_REMOVED,e)}),n&&this.eventEmitter.emit(l.USER_LEFT,t,n),this._maybeStartOrStopP2P(!0),this._maybeClearSITimeout()})},Ne.prototype.onMemberKicked=function(e,t,n,i){if(t===this.myUserId())return;const r=this.participants[t];if(e)return this.eventEmitter.emit(l.KICKED,r,i),void this.leave();const o=this.participants[n];this.eventEmitter.emit(l.PARTICIPANT_KICKED,r,o,i)},Ne.prototype.onLocalRoleChanged=function(e){this.eventEmitter.emit(l.USER_ROLE_CHANGED,this.myUserId(),e)},Ne.prototype.onUserRoleChanged=function(e,t){const n=u.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&(i.setRole(t),this.eventEmitter.emit(l.USER_ROLE_CHANGED,n,t))},Ne.prototype.onDisplayNameChanged=function(e,t){const n=u.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&i._displayName!==t&&(i._displayName=t,this.eventEmitter.emit(l.DISPLAY_NAME_CHANGED,n,t))},Ne.prototype.onRemoteTrackAdded=function(e){if(e.isP2P&&!this.isP2PActive())return void Ae.info("Trying to add remote P2P track, when not in P2P - IGNORED");if(!e.isP2P&&this.isP2PActive())return void Ae.info("Trying to add remote JVB track, when in P2P - IGNORED");const t=e.getParticipantId(),n=this.getParticipantById(t);if(!n)return void Ae.error("No participant found for id: "+t);n._tracks.push(e),this.transcriber&&this.transcriber.addTrack(e);const i=this.eventEmitter;e.addEventListener(_.TRACK_MUTE_CHANGED,()=>i.emit(l.TRACK_MUTE_CHANGED,e)),e.addEventListener(_.TRACK_AUDIO_LEVEL_CHANGED,(e,n)=>{this.getActivePeerConnection()===n&&i.emit(l.TRACK_AUDIO_LEVEL_CHANGED,t,e)}),i.emit(l.TRACK_ADDED,e)},Ne.prototype.onCallAccepted=function(e,t){this.p2pJingleSession===e&&(Ae.info("P2P setAnswer"),this.p2pJingleSession.setAnswer(t),this.eventEmitter.emit(l._MEDIA_SESSION_STARTED,this.p2pJingleSession))},Ne.prototype.onTransportInfo=function(e,t){this.p2pJingleSession===e&&(Ae.info("P2P addIceCandidates"),this.p2pJingleSession.addIceCandidates(t))},Ne.prototype.onRemoteTrackRemoved=function(e){this.getParticipants().forEach(t=>{const n=t.getTracks();for(let i=0;i<n.length;i++)if(n[i]===e){t._tracks.splice(i,1),this.eventEmitter.emit(l.TRACK_REMOVED,e),this.transcriber&&this.transcriber.removeTrack(e);break}},this)},Ne.prototype._onIncomingCallP2P=function(e,t){let n;this.isP2PEnabled()||this.isP2PTestModeEnabled()||!T.a.isFirefox()&&!T.a.isWebKitBased()?this.p2pJingleSession?n={reason:"busy",reasonDescription:"P2P already in progress",errorMsg:'Duplicated P2P "session-initiate"'}:this._shouldBeInP2PMode()||(n={reason:"decline",reasonDescription:"P2P requirements not met",errorMsg:'Received P2P "session-initiate" when should not be in P2P mode'},re.a.sendAnalytics(Object(Se.createJingleEvent)(Se.ACTION_P2P_DECLINED))):n={reason:"decline",reasonDescription:"P2P disabled",errorMsg:"P2P mode disabled in the configuration"},n?this._rejectIncomingCall(e,n):this._acceptP2PIncomingCall(e,t)},Ne.prototype.onIncomingCall=function(e,t,n){if(e.isP2P)this._onIncomingCallP2P(e,t);else{if(!this.room.isFocus(e.remoteJid)){const t="Rejecting session-initiate from non-focus.";return void this._rejectIncomingCall(e,{reason:"security-error",reasonDescription:t,errorMsg:t})}this._acceptJvbIncomingCall(e,t,n)}},Ne.prototype._acceptJvbIncomingCall=function(e,t,n){this.jvbJingleSession=e,this.room.connectionTimes["session.initiate"]=n,this._sendConferenceJoinAnalyticsEvent(),this.wasStopped&&re.a.sendAnalyticsAndLog(Object(Se.createJingleEvent)(Se.ACTION_JINGLE_RESTART,{p2p:!1}));const r=i(t).find('>bridge-session[xmlns="http://jitsi.org/protocol/focus"]').attr("region");this.eventEmitter.emit(l.SERVER_REGION_CHANGED,r),this._maybeClearSITimeout(),re.a.sendAnalytics(Object(Se.createJingleEvent)(Se.ACTION_JINGLE_SI_RECEIVED,{p2p:!1,value:n}));try{e.initialize(this.room,this.rtc,be({},this.options.config,{enableInsertableStreams:this.isE2EEEnabled()}))}catch(e){return ce.a.callErrorHandler(e),void Ae.error(e)}this._setBridgeChannel(t,e.peerconnection);const o=this._getInitialLocalTracks();try{e.acceptOffer(t,()=>{this.isP2PActive()&&this.jvbJingleSession&&this._suspendMediaTransferForJvbConnection(),this.eventEmitter.emit(l._MEDIA_SESSION_STARTED,e),this.isP2PActive()||this.eventEmitter.emit(l._MEDIA_SESSION_ACTIVE_CHANGED,e)},e=>{ce.a.callErrorHandler(e),Ae.error("Failed to accept incoming Jingle session",e)},o),Ae.info("Starting CallStats for JVB connection..."),this.statistics.startCallStats(this.jvbJingleSession.peerconnection,"jitsi"),this.statistics.startRemoteStats(this.jvbJingleSession.peerconnection)}catch(e){ce.a.callErrorHandler(e),Ae.error(e)}},Ne.prototype._setBridgeChannel=function(e,t){let n=null;const r=i(e).find(">content>transport>web-socket").first();1===r.length&&(n=r[0].getAttribute("url")),n?this.rtc.initializeBridgeChannel(null,n):this.rtc.initializeBridgeChannel(t,null)},Ne.prototype._rejectIncomingCall=function(e,t){t&&t.errorMsg&&ce.a.callErrorHandler(new Error(t.errorMsg)),e.terminate(null,e=>{Ae.warn("An error occurred while trying to terminate invalid Jingle session",e)},{reason:t&&t.reason,reasonDescription:t&&t.reasonDescription,sendSessionTerminate:!0})},Ne.prototype.onCallEnded=function(e,t,n){Ae.info(`Call ended: ${t} - ${n} P2P ?${e.isP2P}`),e===this.jvbJingleSession?(this.wasStopped=!0,re.a.sendAnalytics(Object(Se.createJingleEvent)(Se.ACTION_JINGLE_TERMINATE,{p2p:!1})),this.statistics&&(this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection),Ae.info("Stopping JVB CallStats"),this.statistics.stopCallStats(this.jvbJingleSession.peerconnection)),this.jvbJingleSession=null,this.rtc.onCallEnded()):e===this.p2pJingleSession?("decline"===t&&"force JVB121"===n?(Ae.info("In forced JVB 121 mode..."),re.a.analytics.addPermanentProperties({forceJvb121:!0})):"connectivity-error"===t&&"ICE FAILED"===n&&re.a.analytics.addPermanentProperties({p2pFailed:!0}),this._stopP2PSession()):Ae.error("Received onCallEnded for invalid session",e.sid,e.remoteJid,t,n)},Ne.prototype.onSuspendDetected=function(e){e.isP2P||(this.leave(),this.eventEmitter.emit(l.SUSPEND_DETECTED))},Ne.prototype.updateDTMFSupport=function(){let e=!1;const t=this.getParticipants();for(let n=0;n<t.length;n+=1)if(t[n].supportsDTMF()){e=!0;break}e!==this.somebodySupportsDTMF&&(this.somebodySupportsDTMF=e,this.eventEmitter.emit(l.DTMF_SUPPORT_CHANGED,e))},Ne.prototype.isDTMFSupported=function(){return this.somebodySupportsDTMF},Ne.prototype.myUserId=function(){return this.room&&this.room.myroomjid?u.Strophe.getResourceFromJid(this.room.myroomjid):null},Ne.prototype.sendTones=function(e,t,n){const i=this.getActivePeerConnection();i?i.sendTones(e,t,n):Ae.warn("cannot sendTones: no peer connection")},Ne.prototype.startRecording=function(e){return this.room?this.recordingManager.startRecording(e):Promise.reject(new Error("The conference is not created yet!"))},Ne.prototype.stopRecording=function(e){return this.room?this.recordingManager.stopRecording(e):Promise.reject(new Error("The conference is not created yet!"))},Ne.prototype.isSIPCallingSupported=function(){return!!this.room&&this.room.isSIPCallingSupported()},Ne.prototype.dial=function(e){return this.room?this.room.dial(e):new Promise((e,t)=>{t(new Error("The conference is not created yet!"))})},Ne.prototype.hangup=function(){return this.room?this.room.hangup():new Promise((e,t)=>{t(new Error("The conference is not created yet!"))})},Ne.prototype.startTranscriber=function(){return this.dial("jitsi_meet_transcribe")},Ne.prototype.stopTranscriber=Ne.prototype.hangup,Ne.prototype.getPhoneNumber=function(){return this.room?this.room.getPhoneNumber():null},Ne.prototype.getPhonePin=function(){return this.room?this.room.getPhonePin():null},Ne.prototype.getMeetingUniqueId=function(){if(this.room)return this.room.getMeetingId()},Ne.prototype.getActivePeerConnection=function(){const e=this.isP2PActive()?this.p2pJingleSession:this.jvbJingleSession;return e?e.peerconnection:null},Ne.prototype.getConnectionState=function(){const e=this.getActivePeerConnection();return e?e.getConnectionState():null},Ne.prototype.setStartMutedPolicy=function(e){this.isModerator()?(this.startMutedPolicy=e,this.room.addOrReplaceInPresence("startmuted",{attributes:{audio:e.audio,video:e.video,xmlns:"http://jitsi.org/jitmeet/start-muted"}})&&this.room.sendPresence()):Ae.warn(`Failed to set start muted policy, ${this.room?"":"not in a room, "}${this.isModerator()?"":"participant is not a moderator"}`)},Ne.prototype.getStartMutedPolicy=function(){return this.startMutedPolicy},Ne.prototype.isStartAudioMuted=function(){return this.startAudioMuted},Ne.prototype.isStartVideoMuted=function(){return this.startVideoMuted},Ne.prototype.getConnectionTimes=function(){return this.room.connectionTimes},Ne.prototype.setLocalParticipantProperty=function(e,t){this.sendCommand("jitsi_participant_"+e,{value:t})},Ne.prototype.removeLocalParticipantProperty=function(e){this.removeCommand("jitsi_participant_"+e),this.room.sendPresence()},Ne.prototype.getLocalParticipantProperty=function(e){const t=this.room.presMap.nodes.find(t=>t.tagName==="jitsi_participant_"+e);return t?t.value:void 0},Ne.prototype.sendFeedback=function(e,t){return this.statistics.sendFeedback(e,t)},Ne.prototype.isCallstatsEnabled=function(){return this.statistics.isCallstatsEnabled()},Ne.prototype.getSsrcByTrack=function(e){var t;return e.isLocal()?null===(t=this.getActivePeerConnection())||void 0===t?void 0:t.getLocalSSRC(e):e.getSSRC()},Ne.prototype._onTrackAttach=function(e,t){const n=e.isLocal();let i=null;const r=e.isP2P,o=r?e.getParticipantId():"jitsi",s=r?this.p2pJingleSession&&this.p2pJingleSession.peerconnection:this.jvbJingleSession&&this.jvbJingleSession.peerconnection;n?s&&(i=s.getLocalSSRC(e)):i=e.getSSRC(),t.id&&i&&s&&this.statistics.associateStreamWithVideoTag(s,i,n,o,e.getUsageLabel(),t.id)},Ne.prototype.sendApplicationLog=function(e){re.a.sendLog(e)},Ne.prototype._isFocus=function(e){return this.room?this.room.isFocus(e):null},Ne.prototype._fireIncompatibleVersionsEvent=function(){this.eventEmitter.emit(l.CONFERENCE_FAILED,d.INCOMPATIBLE_SERVER_VERSIONS)},Ne.prototype.sendEndpointMessage=function(e,t){this.rtc.sendChannelMessage(e,t)},Ne.prototype.sendEndpointStatsMessage=function(e){this.rtc.sendEndpointStatsMessage(e)},Ne.prototype.broadcastEndpointMessage=function(e){this.sendEndpointMessage("",e)},Ne.prototype.sendMessage=function(e,t="",n=!1){const i=typeof e;if("object"===i||!n&&"string"===i)if(n)this.sendEndpointMessage(t,e);else{let n=e,r="body";if("object"===i){r="json-message",n.hasOwnProperty(fe.c)||(n[fe.c]="");try{n=JSON.stringify(n)}catch(e){return void Ae.error("Can not send a message, stringify failed: ",e)}}t?this.sendPrivateTextMessage(t,n,r):this.sendTextMessage(n,r)}else Ae.error("Can not send a message of type "+i)},Ne.prototype.isConnectionInterrupted=function(){return this.isP2PActive()?this.isP2PConnectionInterrupted:this.isJvbConnectionInterrupted},Ne.prototype._onConferenceRestarted=function(e){!e.isP2P&&this.options.config.enableForcedReload&&(this.restartInProgress=!0,this.eventEmitter.emit(l.CONFERENCE_FAILED,d.CONFERENCE_RESTARTED))},Ne.prototype._onIceConnectionInterrupted=function(e){e.isP2P?this.isP2PConnectionInterrupted=!0:this.isJvbConnectionInterrupted=!0,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(l.CONNECTION_INTERRUPTED)},Ne.prototype._onIceConnectionFailed=function(e){e.isP2P?(re.a.analytics.addPermanentProperties({p2pFailed:!0}),this.p2pJingleSession&&re.a.sendAnalyticsAndLog(Object(Se.createP2PEvent)(Se.ACTION_P2P_FAILED,{initiator:this.p2pJingleSession.isInitiator})),this._stopP2PSession("connectivity-error","ICE FAILED")):e&&this.jvbJingleSession===e&&(this._delayedIceFailed=new N.a(this),this._delayedIceFailed.start(e))},Ne.prototype._onIceConnectionRestored=function(e){e.isP2P?this.isP2PConnectionInterrupted=!1:(this.isJvbConnectionInterrupted=!1,this._delayedIceFailed&&this._delayedIceFailed.cancel()),e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(l.CONNECTION_RESTORED)},Ne.prototype._acceptP2PIncomingCall=function(e,t){this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=e,this._sendConferenceJoinAnalyticsEvent(),this.p2pJingleSession.initialize(this.room,this.rtc,be({},this.options.config,{enableInsertableStreams:this.isE2EEEnabled()})),Ae.info("Starting CallStats for P2P connection...");let n=u.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid);const i=this.participants[n];i&&(n=i.getStatsID()||n),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,n);const r=this.getLocalTracks();this.p2pJingleSession.acceptOffer(t,()=>{Ae.debug('Got RESULT for P2P "session-accept"'),this.eventEmitter.emit(l._MEDIA_SESSION_STARTED,this.p2pJingleSession)},e=>{Ae.error("Failed to accept incoming P2P Jingle session",e)},r)},Ne.prototype._addRemoteJVBTracks=function(){this._addRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},Ne.prototype._addRemoteP2PTracks=function(){this._addRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},Ne.prototype._addRemoteTracks=function(e,t){for(const n of t)Ae.info(`Adding remote ${e} track: ${n}`),this.onRemoteTrackAdded(n)},Ne.prototype._onIceConnectionEstablished=function(e){null!==this.p2pJingleSession&&(this.p2pEstablishmentDuration=this.p2pJingleSession.establishmentDuration),null!==this.jvbJingleSession&&(this.jvbEstablishmentDuration=this.jvbJingleSession.establishmentDuration);let t=!1;const n=this.options.config.forceJVB121Ratio;if(e.isP2P?this.p2pJingleSession!==e?(Ae.error("CONNECTION_ESTABLISHED - wrong P2P session instance ?!"),t=!0):!e.isInitiator&&"number"==typeof n&&Math.random()<n&&(Ae.info(`Forcing JVB 121 mode (ratio=${n})...`),re.a.analytics.addPermanentProperties({forceJvb121:!0}),this._stopP2PSession("decline","force JVB121"),t=!0):t=!0,!isNaN(this.p2pEstablishmentDuration)&&!isNaN(this.jvbEstablishmentDuration)){const e=this.p2pEstablishmentDuration-this.jvbEstablishmentDuration;re.a.sendAnalytics(Se.ICE_ESTABLISHMENT_DURATION_DIFF,{value:e})}e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(l.CONNECTION_ESTABLISHED),t||(this._setP2PStatus(!0),this.jvbJingleSession?this._removeRemoteJVBTracks():Ae.info("Not removing remote JVB tracks - no session yet"),this._addRemoteP2PTracks(),this.jvbJingleSession&&this._suspendMediaTransferForJvbConnection(),Ae.info("Starting remote stats with p2p connection"),this.statistics.startRemoteStats(this.p2pJingleSession.peerconnection),re.a.sendAnalyticsAndLog(Object(Se.createP2PEvent)(Se.ACTION_P2P_ESTABLISHED,{initiator:this.p2pJingleSession.isInitiator})))},Ne.prototype._updateProperties=function(e={}){const t=!c()(e,this.properties);if(this.properties=e,t){this.eventEmitter.emit(l.PROPERTIES_CHANGED,this.properties);["bridge-count","created-ms"].forEach(t=>{void 0!==e[t]&&re.a.analytics.addPermanentProperties({[t.replace("-","_")]:e[t]})})}},Ne.prototype.getProperty=function(e){return this.properties[e]},Ne.prototype._maybeClearDeferredStartP2P=function(){this.deferredStartP2PTask&&(Ae.info("Cleared deferred start P2P task"),clearTimeout(this.deferredStartP2PTask),this.deferredStartP2PTask=null)},Ne.prototype._removeRemoteJVBTracks=function(){this._removeRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},Ne.prototype._removeRemoteP2PTracks=function(){this._removeRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},Ne.prototype._removeRemoteTracks=function(e,t){for(const n of t)Ae.info(`Removing remote ${e} track: ${n}`),this.onRemoteTrackRemoved(n)},Ne.prototype._resumeMediaTransferForJvbConnection=function(){Ae.info("Resuming media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!0,!0).then(()=>{Ae.info("Resumed media transfer over the JVB connection!")},e=>{Ae.error("Failed to resume media transfer over the JVB connection:",e)})},Ne.prototype._setP2PStatus=function(e){if(this.p2p!==e){if(this.p2p=e,e){Ae.info("Peer to peer connection established!"),re.a.analytics.addPermanentProperties({p2pFailed:!1,forceJvb121:!1});const e=0!==this.getLastN();this.p2pJingleSession.setMediaTransferActive(!0,e).catch(t=>{Ae.error(`Failed to sync up P2P video transfer status(${e})`,t)})}else Ae.info("Peer to peer connection closed!");this.jvbJingleSession&&this.statistics.sendConnectionResumeOrHoldEvent(this.jvbJingleSession.peerconnection,!e),this.dtmfManager=null,this.eventEmitter.emit(l.P2P_STATUS,this,this.p2p),this.eventEmitter.emit(l._MEDIA_SESSION_ACTIVE_CHANGED,this._getActiveMediaSession()),this.eventEmitter.emit(this.isConnectionInterrupted()?l.CONNECTION_INTERRUPTED:l.CONNECTION_RESTORED)}else Ae.debug("Called _setP2PStatus with the same status: "+e)},Ne.prototype._startP2PSession=function(e){if(this._maybeClearDeferredStartP2P(),this.p2pJingleSession)return void Ae.error("P2P session already started!");this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=this.xmpp.connection.jingle.newP2PJingleSession(this.room.myroomjid,e),Ae.info("Created new P2P JingleSession",this.room.myroomjid,e),this._sendConferenceJoinAnalyticsEvent(),this.p2pJingleSession.initialize(this.room,this.rtc,be({},this.options.config,{enableInsertableStreams:this.isE2EEEnabled()})),Ae.info("Starting CallStats for P2P connection...");let t=u.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid);const n=this.participants[t];n&&(t=n.getStatsID()||t),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,t);const i=this.getLocalTracks();this.p2pJingleSession.invite(i)},Ne.prototype._suspendMediaTransferForJvbConnection=function(){Ae.info("Suspending media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!1,!1).then(()=>{Ae.info("Suspended media transfer over the JVB connection !")},e=>{Ae.error("Failed to suspend media transfer over the JVB connection:",e)})},Ne.prototype._maybeStartOrStopP2P=function(e){if(!this.isP2PEnabled()||this.isP2PTestModeEnabled()||T.a.isFirefox()||T.a.isWebKitBased())return void Ae.info("Auto P2P disabled");const t=this.getParticipants(),n=t.length,i=this._shouldBeInP2PMode();if(!i&&this.deferredStartP2PTask&&this._maybeClearDeferredStartP2P(),!this.p2pJingleSession&&i){const i=n&&t[0],r=this.myUserId(),o=i.getId();if(r>o)return void Ae.debug("I'm the bigger peersId - the other peer should start P2P",r,o);if(r===o)return void Ae.error("The same IDs ? ",r,o);const s=i.getJid();if(e){if(this.deferredStartP2PTask)return void Ae.error("Deferred start P2P task's been set already!");Ae.info(`Will start P2P with: ${s} after ${this.backToP2PDelay} seconds...`),this.deferredStartP2PTask=setTimeout(this._startP2PSession.bind(this,s),1e3*this.backToP2PDelay)}else Ae.info("Will start P2P with: "+s),this._startP2PSession(s)}else this.p2pJingleSession&&!i&&(Ae.info("Will stop P2P with: "+this.p2pJingleSession.remoteJid),this.p2pJingleSession.isInitiator&&n>1&&re.a.sendAnalyticsAndLog(Object(Se.createP2PEvent)(Se.ACTION_P2P_SWITCH_TO_JVB)),this._stopP2PSession())},Ne.prototype._shouldBeInP2PMode=function(){const e=this.getParticipants(),t=e.length,n=void 0!==e.find(e=>"poltergeist"===e.getBotType()||e.hasFeature(fe.b)),i=1===t&&!n;return Ae.debug(`P2P? peerCount: ${t}, hasBotPeer: ${n} => ${i}`),i},Ne.prototype._stopP2PSession=function(e,t){if(!this.p2pJingleSession)return void Ae.error("No P2P session to be stopped!");const n=this.isP2PActive();n&&(this.jvbJingleSession&&this._resumeMediaTransferForJvbConnection(),this._removeRemoteP2PTracks()),Ae.info("Stopping remote stats for P2P connection"),this.statistics.stopRemoteStats(this.p2pJingleSession.peerconnection),Ae.info("Stopping CallStats for P2P connection"),this.statistics.stopCallStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.terminate(()=>{Ae.info("P2P session terminate RESULT")},t=>{e&&Ae.error("An error occurred while trying to terminate P2P Jingle session",t)},{reason:e||"success",reasonDescription:t||"Turing off P2P session",sendSessionTerminate:this.room&&this.getParticipantById(u.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid))}),this.p2pJingleSession=null,this._setP2PStatus(!1),n&&(this.jvbJingleSession?this._addRemoteJVBTracks():Ae.info("Not adding remote JVB tracks - no session yet"))},Ne.prototype.isP2PActive=function(){return this.p2p},Ne.prototype.getP2PConnectionState=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection.getConnectionState():null},Ne.prototype.startP2PSession=function(){const e=this.getParticipants();if(1!==e.length)throw new Error("There must be exactly 1 participant to start the P2P session !");{const t=e[0].getJid();this._startP2PSession(t)}},Ne.prototype.stopP2PSession=function(){this._stopP2PSession()},Ne.prototype.getSpeakerStats=function(){return this.speakerStatsCollector.getStats()},Ne.prototype.setReceiverConstraints=function(e){this.receiveVideoController.setReceiverConstraints(e)},Ne.prototype.setReceiverVideoConstraint=function(e){this.receiveVideoController.setPreferredReceiveMaxFrameHeight(e)},Ne.prototype.setSenderVideoConstraint=function(e){return this.sendVideoController.setPreferredSendMaxFrameHeight(e)},Ne.prototype.createVideoSIPGWSession=function(e,t){return this.room?this.videoSIPGWHandler.createVideoSIPGWSession(e,t):new Error(pe.ERROR_NO_CONNECTION)},Ne.prototype._sendConferenceJoinAnalyticsEvent=function(){const e=this.getMeetingUniqueId();!this._conferenceJoinAnalyticsEventSent&&e&&null!==this.getActivePeerConnection()&&(re.a.sendAnalytics(Object(Se.createConferenceEvent)("joined",{meetingId:e,participantId:`${e}.${this._statsCurrentId}`})),this._conferenceJoinAnalyticsEventSent=Date.now())},Ne.prototype._sendConferenceLeftAnalyticsEvent=function(){const e=this.getMeetingUniqueId();e&&this._conferenceJoinAnalyticsEventSent&&re.a.sendAnalytics(Object(Se.createConferenceEvent)("left",{meetingId:e,participantId:`${e}.${this._statsCurrentId}`,stats:{duration:Math.floor((Date.now()-this._conferenceJoinAnalyticsEventSent)/1e3),perf:this.getPerformanceStats()}}))},Ne.prototype._restartMediaSessions=function(){this.p2pJingleSession&&this.stopP2PSession(),this.jvbJingleSession&&this.jvbJingleSession.terminate(null,e=>{Ae.warn("An error occurred while trying to terminate the JVB session",e)},{reason:"success",reasonDescription:"restart required",requestRestart:!0,sendSessionTerminate:!0}),this._maybeStartOrStopP2P(!1)},Ne.prototype.isE2EEEnabled=function(){return this._e2eEncryption&&this._e2eEncryption.isEnabled()},Ne.prototype.isE2EESupported=function(){return U.E2EEncryption.isSupported(this.options.config)},Ne.prototype.toggleE2EE=function(e){this.isE2EESupported()?this._e2eEncryption.setEnabled(e):Ae.warn("Cannot enable / disable E2EE: platform is not supported.")},Ne.prototype.isLobbySupported=function(){return Boolean(this.room&&this.room.getLobby().isSupported())},Ne.prototype.isMembersOnly=function(){return Boolean(this.room&&this.room.membersOnlyEnabled)},Ne.prototype.enableLobby=function(){return this.room&&this.isModerator()?this.room.getLobby().enable():Promise.reject(new Error("The conference not started or user is not moderator"))},Ne.prototype.disableLobby=function(){this.room&&this.isModerator()?this.room.getLobby().disable():Ae.warn(`Failed to disable lobby, ${this.room?"":"not in a room, "}${this.isModerator()?"":"participant is not a moderator"}`)},Ne.prototype.joinLobby=function(e,t){return this.room?this.room.getLobby().join(e,t):Promise.reject(new Error("The conference not started"))},Ne.prototype.lobbyDenyAccess=function(e){this.room&&this.room.getLobby().denyAccess(e)},Ne.prototype.lobbyApproveAccess=function(e){this.room&&this.room.getLobby().approveAccess(e)},Ne.prototype.isAVModerationSupported=function(){return Boolean(this.room&&this.room.getAVModeration().isSupported())},Ne.prototype.enableAVModeration=function(e){this.room&&this.isModerator()&&(e===ge.AUDIO||e===ge.VIDEO)?this.room.getAVModeration().enable(!0,e):Ae.warn(`Failed to enable AV moderation, ${this.room?"":"not in a room, "}${this.isModerator()?"":"participant is not a moderator, "}${this.room&&this.isModerator()?"wrong media type passed":""}`)},Ne.prototype.disableAVModeration=function(e){this.room&&this.isModerator()&&(e===ge.AUDIO||e===ge.VIDEO)?this.room.getAVModeration().enable(!1,e):Ae.warn(`Failed to disable AV moderation, ${this.room?"":"not in a room, "}${this.isModerator()?"":"participant is not a moderator, "}${this.room&&this.isModerator()?"wrong media type passed":""}`)},Ne.prototype.avModerationApprove=function(e,t){if(this.room&&this.isModerator()&&(e===ge.AUDIO||e===ge.VIDEO)){const n=this.getParticipantById(t);if(!n)return;this.room.getAVModeration().approve(e,n.getJid())}else Ae.warn(`AV moderation skipped , ${this.room?"":"not in a room, "}${this.isModerator()?"":"participant is not a moderator, "}${this.room&&this.isModerator()?"wrong media type passed":""}`)},Ne.prototype.getLocalUser=function(){if(this.user)return this.user}}).call(this,"src/JitsiConference.js",n(40))},function(e,t,n){(function(e,n){var i="[object Arguments]",r="[object Map]",o="[object Object]",s="[object Set]",a=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u[i]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u[r]=u["[object Number]"]=u[o]=u["[object RegExp]"]=u[s]=u["[object String]"]=u["[object WeakMap]"]=!1;var d="object"==typeof e&&e&&e.Object===Object&&e,h="object"==typeof self&&self&&self.Object===Object&&self,l=d||h||Function("return this")(),p=t&&!t.nodeType&&t,f=p&&"object"==typeof n&&n&&!n.nodeType&&n,m=f&&f.exports===p,_=m&&d.process,g=function(){try{return _&&_.binding&&_.binding("util")}catch(e){}}(),E=g&&g.isTypedArray;function v(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}function S(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function y(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var T,b,C,A=Array.prototype,N=Function.prototype,O=Object.prototype,I=l["__core-js_shared__"],R=N.toString,D=O.hasOwnProperty,P=(T=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"",L=O.toString,w=RegExp("^"+R.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),M=m?l.Buffer:void 0,x=l.Symbol,F=l.Uint8Array,j=O.propertyIsEnumerable,k=A.splice,H=x?x.toStringTag:void 0,U=Object.getOwnPropertySymbols,J=M?M.isBuffer:void 0,B=(b=Object.keys,C=Object,function(e){return b(C(e))}),V=ge(l,"DataView"),G=ge(l,"Map"),q=ge(l,"Promise"),$=ge(l,"Set"),W=ge(l,"WeakMap"),K=ge(Object,"create"),X=ye(V),z=ye(G),Y=ye(q),Q=ye($),Z=ye(W),ee=x?x.prototype:void 0,te=ee?ee.valueOf:void 0;function ne(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function oe(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new re;++t<n;)this.add(e[t])}function se(e){var t=this.__data__=new ie(e);this.size=t.size}function ae(e,t){var n=Ce(e),i=!n&&be(e),r=!n&&!i&&Ae(e),o=!n&&!i&&!r&&De(e),s=n||i||r||o,a=s?function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],c=a.length;for(var u in e)!t&&!D.call(e,u)||s&&("length"==u||r&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Se(u,c))||a.push(u);return a}function ce(e,t){for(var n=e.length;n--;)if(Te(e[n][0],t))return n;return-1}function ue(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":H&&H in Object(e)?function(e){var t=D.call(e,H),n=e[H];try{e[H]=void 0;var i=!0}catch(e){}var r=L.call(e);i&&(t?e[H]=n:delete e[H]);return r}(e):function(e){return L.call(e)}(e)}function de(e){return Re(e)&&ue(e)==i}function he(e,t,n,a,c){return e===t||(null==e||null==t||!Re(e)&&!Re(t)?e!=e&&t!=t:function(e,t,n,a,c,u){var d=Ce(e),h=Ce(t),l=d?"[object Array]":ve(e),p=h?"[object Array]":ve(t),f=(l=l==i?o:l)==o,m=(p=p==i?o:p)==o,_=l==p;if(_&&Ae(e)){if(!Ae(t))return!1;d=!0,f=!1}if(_&&!f)return u||(u=new se),d||De(e)?fe(e,t,n,a,c,u):function(e,t,n,i,o,a,c){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new F(e),new F(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Te(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case r:var u=S;case s:var d=1&i;if(u||(u=y),e.size!=t.size&&!d)return!1;var h=c.get(e);if(h)return h==t;i|=2,c.set(e,t);var l=fe(u(e),u(t),i,o,a,c);return c.delete(e),l;case"[object Symbol]":if(te)return te.call(e)==te.call(t)}return!1}(e,t,l,n,a,c,u);if(!(1&n)){var g=f&&D.call(e,"__wrapped__"),E=m&&D.call(t,"__wrapped__");if(g||E){var v=g?e.value():e,T=E?t.value():t;return u||(u=new se),c(v,T,n,a,u)}}if(!_)return!1;return u||(u=new se),function(e,t,n,i,r,o){var s=1&n,a=me(e),c=a.length,u=me(t).length;if(c!=u&&!s)return!1;var d=c;for(;d--;){var h=a[d];if(!(s?h in t:D.call(t,h)))return!1}var l=o.get(e);if(l&&o.get(t))return l==t;var p=!0;o.set(e,t),o.set(t,e);var f=s;for(;++d<c;){h=a[d];var m=e[h],_=t[h];if(i)var g=s?i(_,m,h,t,e,o):i(m,_,h,e,t,o);if(!(void 0===g?m===_||r(m,_,n,i,o):g)){p=!1;break}f||(f="constructor"==h)}if(p&&!f){var E=e.constructor,v=t.constructor;E==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof E&&E instanceof E&&"function"==typeof v&&v instanceof v||(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,a,c,u)}(e,t,n,a,he,c))}function le(e){return!(!Ie(e)||function(e){return!!P&&P in e}(e))&&(Ne(e)?w:a).test(ye(e))}function pe(e){if(n=(t=e)&&t.constructor,i="function"==typeof n&&n.prototype||O,t!==i)return B(e);var t,n,i,r=[];for(var o in Object(e))D.call(e,o)&&"constructor"!=o&&r.push(o);return r}function fe(e,t,n,i,r,o){var s=1&n,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var d=-1,h=!0,l=2&n?new oe:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var p=e[d],f=t[d];if(i)var m=s?i(f,p,d,t,e,o):i(p,f,d,e,t,o);if(void 0!==m){if(m)continue;h=!1;break}if(l){if(!v(t,(function(e,t){if(s=t,!l.has(s)&&(p===e||r(p,e,n,i,o)))return l.push(t);var s}))){h=!1;break}}else if(p!==f&&!r(p,f,n,i,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function me(e){return function(e,t,n){var i=t(e);return Ce(e)?i:function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}(i,n(e))}(e,Pe,Ee)}function _e(e,t){var n,i,r=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function ge(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return le(n)?n:void 0}ne.prototype.clear=function(){this.__data__=K?K(null):{},this.size=0},ne.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ne.prototype.get=function(e){var t=this.__data__;if(K){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return D.call(t,e)?t[e]:void 0},ne.prototype.has=function(e){var t=this.__data__;return K?void 0!==t[e]:D.call(t,e)},ne.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=K&&void 0===t?"__lodash_hash_undefined__":t,this},ie.prototype.clear=function(){this.__data__=[],this.size=0},ie.prototype.delete=function(e){var t=this.__data__,n=ce(t,e);return!(n<0)&&(n==t.length-1?t.pop():k.call(t,n,1),--this.size,!0)},ie.prototype.get=function(e){var t=this.__data__,n=ce(t,e);return n<0?void 0:t[n][1]},ie.prototype.has=function(e){return ce(this.__data__,e)>-1},ie.prototype.set=function(e,t){var n=this.__data__,i=ce(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},re.prototype.clear=function(){this.size=0,this.__data__={hash:new ne,map:new(G||ie),string:new ne}},re.prototype.delete=function(e){var t=_e(this,e).delete(e);return this.size-=t?1:0,t},re.prototype.get=function(e){return _e(this,e).get(e)},re.prototype.has=function(e){return _e(this,e).has(e)},re.prototype.set=function(e,t){var n=_e(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},oe.prototype.add=oe.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},oe.prototype.has=function(e){return this.__data__.has(e)},se.prototype.clear=function(){this.__data__=new ie,this.size=0},se.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ie){var i=n.__data__;if(!G||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new re(i)}return n.set(e,t),this.size=n.size,this};var Ee=U?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var s=e[n];t(s,n,e)&&(o[r++]=s)}return o}(U(e),(function(t){return j.call(e,t)})))}:function(){return[]},ve=ue;function Se(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||c.test(e))&&e>-1&&e%1==0&&e<t}function ye(e){if(null!=e){try{return R.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Te(e,t){return e===t||e!=e&&t!=t}(V&&"[object DataView]"!=ve(new V(new ArrayBuffer(1)))||G&&ve(new G)!=r||q&&"[object Promise]"!=ve(q.resolve())||$&&ve(new $)!=s||W&&"[object WeakMap]"!=ve(new W))&&(ve=function(e){var t=ue(e),n=t==o?e.constructor:void 0,i=n?ye(n):"";if(i)switch(i){case X:return"[object DataView]";case z:return r;case Y:return"[object Promise]";case Q:return s;case Z:return"[object WeakMap]"}return t});var be=de(function(){return arguments}())?de:function(e){return Re(e)&&D.call(e,"callee")&&!j.call(e,"callee")},Ce=Array.isArray;var Ae=J||function(){return!1};function Ne(e){if(!Ie(e))return!1;var t=ue(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Oe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Ie(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Re(e){return null!=e&&"object"==typeof e}var De=E?function(e){return function(t){return e(t)}}(E):function(e){return Re(e)&&Oe(e.length)&&!!u[ue(e)]};function Pe(e){return null!=(t=e)&&Oe(t.length)&&!Ne(t)?ae(e):pe(e);var t}n.exports=function(e,t){return he(e,t)}}).call(this,n(39),n(94)(e))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return b}));var i=n(15),r=n(5),o=n(7),s=n(1),a=n(37),c=n(3),u=n.n(c),d=n(50),h=n.n(d),l=n(4),p=n(12),f=n.n(p),m=n(23),_=n.n(m),g=n(51),E=n.n(g),v=n(6),S=n(2),y=n.n(S);const T=Object(i.getLogger)(e);function b(e){this.conference=e,this.xmppListeners={},e.on(s.TRACK_MUTE_CHANGED,t=>{if(!t.isLocal()||!e.statistics)return;const n=t.isP2P?e.p2pJingleSession:e.jvbJingleSession,i=n&&n.peerconnection||null;e.statistics.sendMuteEvent(i,t.isMuted(),t.getType())})}b.prototype.setupChatRoomListeners=function(){const e=this.conference,t=e.room;this.chatRoomForwarder=new h.a(t,this.conference.eventEmitter),t.addListener(y.a.ICE_RESTARTING,t=>{t.isP2P||e.rtc.closeBridgeChannel()}),t.addListener(y.a.PARTICIPANT_FEATURES_CHANGED,(t,n)=>{const i=e.getParticipantById(r.Strophe.getResourceFromJid(t));i&&(i.setFeatures(n),e.eventEmitter.emit(s.PARTCIPANT_FEATURES_CHANGED,i))}),t.addListener(y.a.ICE_RESTART_SUCCESS,(t,n)=>{!t.isP2P&&e._setBridgeChannel(n,t.peerconnection)}),t.addListener(y.a.AUDIO_MUTED_BY_FOCUS,t=>{u.a.sendAnalytics(Object(v.createRemotelyMutedEvent)(l.AUDIO)),e.mutedByFocusActor=t,e.rtc.setAudioMute(!0).then(()=>{e.isMutedByFocus=!0,e.mutedByFocusActor=null}).catch(t=>{e.mutedByFocusActor=null,T.warn("Error while audio muting due to focus request",t)})}),t.addListener(y.a.VIDEO_MUTED_BY_FOCUS,t=>{u.a.sendAnalytics(Object(v.createRemotelyMutedEvent)(l.VIDEO)),e.mutedVideoByFocusActor=t,e.rtc.setVideoMute(!0).then(()=>{e.isVideoMutedByFocus=!0,e.mutedVideoByFocusActor=null}).catch(t=>{e.mutedVideoByFocusActor=null,T.warn("Error while video muting due to focus request",t)})}),this.chatRoomForwarder.forward(y.a.SUBJECT_CHANGED,s.SUBJECT_CHANGED),this.chatRoomForwarder.forward(y.a.MUC_JOINED,s.CONFERENCE_JOINED),this.chatRoomForwarder.forward(y.a.MEETING_ID_SET,s.CONFERENCE_UNIQUE_ID_SET),t.addListener(y.a.MUC_JOINED,()=>{this.conference._onMucJoined(),this.conference.isJvbConnectionInterrupted=!1,Object.keys(t.connectionTimes).forEach(e=>{const n=Object(v.createConnectionStageReachedEvent)("conference_"+e,{value:t.connectionTimes[e]});u.a.sendAnalytics(n)}),Object.keys(t.xmpp.connectionTimes).forEach(e=>{const n=Object(v.createConnectionStageReachedEvent)("xmpp_"+e,{value:t.xmpp.connectionTimes[e]});u.a.sendAnalytics(n)})}),t.addListener(y.a.RENEGOTIATION_FAILED,(t,n)=>{n.isP2P||e.eventEmitter.emit(s.CONFERENCE_FAILED,o.OFFER_ANSWER_FAILED,t)}),this.chatRoomForwarder.forward(y.a.ROOM_JOIN_ERROR,s.CONFERENCE_FAILED,o.CONNECTION_ERROR),this.chatRoomForwarder.forward(y.a.ROOM_CONNECT_ERROR,s.CONFERENCE_FAILED,o.CONNECTION_ERROR),this.chatRoomForwarder.forward(y.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,s.CONFERENCE_FAILED,o.NOT_ALLOWED_ERROR),this.chatRoomForwarder.forward(y.a.ROOM_CONNECT_MEMBERS_ONLY_ERROR,s.CONFERENCE_FAILED,o.MEMBERS_ONLY_ERROR),this.chatRoomForwarder.forward(y.a.ROOM_MAX_USERS_ERROR,s.CONFERENCE_FAILED,o.CONFERENCE_MAX_USERS),this.chatRoomForwarder.forward(y.a.PASSWORD_REQUIRED,s.CONFERENCE_FAILED,o.PASSWORD_REQUIRED),this.chatRoomForwarder.forward(y.a.AUTHENTICATION_REQUIRED,s.CONFERENCE_FAILED,o.AUTHENTICATION_REQUIRED),this.chatRoomForwarder.forward(y.a.BRIDGE_DOWN,s.CONFERENCE_FAILED,o.VIDEOBRIDGE_NOT_AVAILABLE),t.addListener(y.a.BRIDGE_DOWN,()=>u.a.sendAnalytics(Object(v.createBridgeDownEvent)())),t.addListener(y.a.CONNECTION_RESTARTED,t=>{e._onConferenceRestarted(t)}),this.chatRoomForwarder.forward(y.a.RESERVATION_ERROR,s.CONFERENCE_FAILED,o.RESERVATION_ERROR),this.chatRoomForwarder.forward(y.a.GRACEFUL_SHUTDOWN,s.CONFERENCE_FAILED,o.GRACEFUL_SHUTDOWN),t.addListener(y.a.CONNECTION_ICE_FAILED,t=>{e._onIceConnectionFailed(t)}),this.chatRoomForwarder.forward(y.a.MUC_DESTROYED,s.CONFERENCE_FAILED,o.CONFERENCE_DESTROYED),this.chatRoomForwarder.forward(y.a.CHAT_ERROR_RECEIVED,s.CONFERENCE_ERROR,o.CHAT_ERROR),this.chatRoomForwarder.forward(y.a.FOCUS_DISCONNECTED,s.CONFERENCE_FAILED,o.FOCUS_DISCONNECTED),t.addListener(y.a.FOCUS_LEFT,()=>{u.a.sendAnalytics(Object(v.createFocusLeftEvent)()),e.eventEmitter.emit(s.CONFERENCE_FAILED,o.FOCUS_LEFT)}),t.addListener(y.a.SESSION_ACCEPT_TIMEOUT,e=>{u.a.sendAnalyticsAndLog(Object(v.createJingleEvent)(v.ACTION_JINGLE_SA_TIMEOUT,{p2p:e.isP2P}))}),t.addListener(y.a.RECORDER_STATE_CHANGED,(t,n)=>{if(n){const i=e.getParticipantById(r.Strophe.getResourceFromJid(n));"off"===t.getStatus()?t.setTerminator(i):"on"===t.getStatus()&&t.setInitiator(i)}e.eventEmitter.emit(s.RECORDER_STATE_CHANGED,t)}),this.chatRoomForwarder.forward(y.a.TRANSCRIPTION_STATUS_CHANGED,s.TRANSCRIPTION_STATUS_CHANGED),this.chatRoomForwarder.forward(y.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,s.VIDEO_SIP_GW_AVAILABILITY_CHANGED),this.chatRoomForwarder.forward(y.a.VIDEO_SIP_GW_SESSION_STATE_CHANGED,s.VIDEO_SIP_GW_SESSION_STATE_CHANGED),this.chatRoomForwarder.forward(y.a.PHONE_NUMBER_CHANGED,s.PHONE_NUMBER_CHANGED),t.setParticipantPropertyListener((t,n)=>{const i=e.getParticipantById(n);i&&i.setProperty(t.tagName.substring("jitsi_participant_".length),t.value)}),t.addListener(y.a.KICKED,e.onMemberKicked.bind(e)),t.addListener(y.a.SUSPEND_DETECTED,e.onSuspendDetected.bind(e)),this.chatRoomForwarder.forward(y.a.MUC_LOCK_CHANGED,s.LOCK_STATE_CHANGED),this.chatRoomForwarder.forward(y.a.MUC_MEMBERS_ONLY_CHANGED,s.MEMBERS_ONLY_CHANGED),t.addListener(y.a.MUC_MEMBER_JOINED,e.onMemberJoined.bind(e)),this.chatRoomForwarder.forward(y.a.MUC_LOBBY_MEMBER_JOINED,s.LOBBY_USER_JOINED),this.chatRoomForwarder.forward(y.a.MUC_LOBBY_MEMBER_UPDATED,s.LOBBY_USER_UPDATED),this.chatRoomForwarder.forward(y.a.MUC_LOBBY_MEMBER_LEFT,s.LOBBY_USER_LEFT),t.addListener(y.a.MUC_MEMBER_BOT_TYPE_CHANGED,e._onMemberBotTypeChanged.bind(e)),t.addListener(y.a.MUC_MEMBER_LEFT,e.onMemberLeft.bind(e)),this.chatRoomForwarder.forward(y.a.MUC_LEFT,s.CONFERENCE_LEFT),this.chatRoomForwarder.forward(y.a.MUC_DENIED_ACCESS,s.CONFERENCE_FAILED,o.CONFERENCE_ACCESS_DENIED),t.addListener(y.a.DISPLAY_NAME_CHANGED,e.onDisplayNameChanged.bind(e)),t.addListener(y.a.LOCAL_ROLE_CHANGED,t=>{e.onLocalRoleChanged(t),e.statistics&&e.isModerator()&&e.on(s.RECORDER_STATE_CHANGED,e=>{const t={error:e.getError(),id:"recorder_status",status:e.getStatus()};u.a.sendLog(JSON.stringify(t))})}),t.addListener(y.a.MUC_ROLE_CHANGED,e.onUserRoleChanged.bind(e)),t.addListener(E.a.IDENTITY_UPDATED,(t,n)=>{e.authEnabled=t,e.authIdentity=n,e.eventEmitter.emit(s.AUTH_STATUS_CHANGED,t,n)}),t.addListener(y.a.MESSAGE_RECEIVED,(t,n,i,o)=>{const a=r.Strophe.getResourceFromJid(t);e.eventEmitter.emit(s.MESSAGE_RECEIVED,a,n,o)}),t.addListener(y.a.PRIVATE_MESSAGE_RECEIVED,(t,n,i,o)=>{const a=r.Strophe.getResourceFromJid(t);e.eventEmitter.emit(s.PRIVATE_MESSAGE_RECEIVED,a,n,o)}),t.addListener(y.a.PRESENCE_STATUS,(t,n)=>{const i=r.Strophe.getResourceFromJid(t),o=e.getParticipantById(i);o&&o._status!==n&&(o._status=n,e.eventEmitter.emit(s.USER_STATUS_CHANGED,i,n))}),t.addListener(y.a.JSON_MESSAGE_RECEIVED,(t,n)=>{const i=r.Strophe.getResourceFromJid(t),o=e.getParticipantById(i);o?e.eventEmitter.emit(s.ENDPOINT_MESSAGE_RECEIVED,o,n):T.warn("Ignored XMPPEvents.JSON_MESSAGE_RECEIVED for not existing participant: "+t,n)}),t.addPresenceListener("startmuted",(t,n)=>{let i=!1;if(e.myUserId()===n&&e.isModerator())i=!0;else{const t=e.getParticipantById(n);t&&t.isModerator()&&(i=!0)}if(!i)return;const r="true"===t.attributes.audio,o="true"===t.attributes.video;let a=!1;r!==e.startMutedPolicy.audio&&(e.startMutedPolicy.audio=r,a=!0),o!==e.startMutedPolicy.video&&(e.startMutedPolicy.video=o,a=!0),a&&e.eventEmitter.emit(s.START_MUTED_POLICY_CHANGED,e.startMutedPolicy)}),e.statistics&&(t.addListener(y.a.CONNECTION_ICE_FAILED,t=>{e.statistics.sendIceConnectionFailedEvent(t.peerconnection)}),t.addListener(y.a.ADD_ICE_CANDIDATE_FAILED,(t,n)=>{e.statistics.sendAddIceCandidateFailed(t,n)}))},b.prototype.setupRTCListeners=function(){const e=this.conference,t=e.rtc;t.addListener(f.a.REMOTE_TRACK_ADDED,e.onRemoteTrackAdded.bind(e)),t.addListener(f.a.REMOTE_TRACK_REMOVED,e.onRemoteTrackRemoved.bind(e)),t.addListener(f.a.DOMINANT_SPEAKER_CHANGED,(t,n)=>{if(e.lastDominantSpeaker!==t&&e.room){if(e.lastDominantSpeaker=t,e.eventEmitter.emit(s.DOMINANT_SPEAKER_CHANGED,t,n),n&&n.length){const i=n.slice(0);e.myUserId!==t&&i.splice(0,0,t),i.length>a.SPEAKERS_AUDIO_LEVELS&&i.splice(a.SPEAKERS_AUDIO_LEVELS,i.length-a.SPEAKERS_AUDIO_LEVELS),e.statistics&&e.statistics.setSpeakerList(i)}e.statistics&&e.myUserId()===t&&e.statistics.sendDominantSpeakerEvent(e.room.roomjid)}}),t.addListener(f.a.DATA_CHANNEL_OPEN,()=>{const t=window.performance.now(),n="data.channel.opened";T.log(`(TIME) ${n}:\t`,t),e.room.connectionTimes[n]=t,u.a.sendAnalytics(Object(v.createConnectionStageReachedEvent)(n,{value:t})),e.eventEmitter.emit(s.DATA_CHANNEL_OPENED)}),t.addListener(f.a.ENDPOINT_MESSAGE_RECEIVED,(t,n)=>{const i=e.getParticipantById(t);i?e.eventEmitter.emit(s.ENDPOINT_MESSAGE_RECEIVED,i,n):T.warn("Ignored ENDPOINT_MESSAGE_RECEIVED for not existing participant: "+t,n)}),t.addListener(f.a.ENDPOINT_STATS_RECEIVED,(t,n)=>{const i=e.getParticipantById(t);i?e.eventEmitter.emit(s.ENDPOINT_STATS_RECEIVED,i,n):T.warn("Ignoring ENDPOINT_STATS_RECEIVED for a non-existant participant: "+t)}),t.addListener(f.a.LOCAL_UFRAG_CHANGED,(e,t)=>{e.isP2P||u.a.sendLog(JSON.stringify({id:"local_ufrag",value:t}))}),t.addListener(f.a.REMOTE_UFRAG_CHANGED,(e,t)=>{e.isP2P||u.a.sendLog(JSON.stringify({id:"remote_ufrag",value:t}))}),t.addListener(f.a.CREATE_ANSWER_FAILED,(t,n)=>{e.statistics.sendCreateAnswerFailed(t,n),n.isP2P||e.eventEmitter.emit(s.CONFERENCE_FAILED,o.OFFER_ANSWER_FAILED,t)}),t.addListener(f.a.CREATE_OFFER_FAILED,(t,n)=>{e.statistics.sendCreateOfferFailed(t,n),n.isP2P||e.eventEmitter.emit(s.CONFERENCE_FAILED,o.OFFER_ANSWER_FAILED,t)}),t.addListener(f.a.SET_LOCAL_DESCRIPTION_FAILED,(t,n)=>{e.statistics.sendSetLocalDescFailed(t,n),n.isP2P||e.eventEmitter.emit(s.CONFERENCE_FAILED,o.OFFER_ANSWER_FAILED,t)}),t.addListener(f.a.SET_REMOTE_DESCRIPTION_FAILED,(t,n)=>{e.statistics.sendSetRemoteDescFailed(t,n),n.isP2P||e.eventEmitter.emit(s.CONFERENCE_FAILED,o.OFFER_ANSWER_FAILED,t)}),t.addListener(f.a.LOCAL_TRACK_SSRC_UPDATED,(t,n)=>{t.isVideoTrack()&&t.videoType===_.a.DESKTOP&&e.statistics.sendScreenSharingEvent(!0,n)})},b.prototype.removeXMPPListeners=function(){const e=this.conference;Object.keys(this.xmppListeners).forEach(t=>{e.xmpp.removeListener(t,this.xmppListeners[t])}),this.xmppListeners={}},b.prototype.setupXMPPListeners=function(){const e=this.conference;this._addConferenceXMPPListener(y.a.CALL_INCOMING,e.onIncomingCall.bind(e)),this._addConferenceXMPPListener(y.a.CALL_ACCEPTED,e.onCallAccepted.bind(e)),this._addConferenceXMPPListener(y.a.TRANSPORT_INFO,e.onTransportInfo.bind(e)),this._addConferenceXMPPListener(y.a.CALL_ENDED,e.onCallEnded.bind(e)),this._addConferenceXMPPListener(y.a.START_MUTED_FROM_FOCUS,(t,n)=>{e.options.config.ignoreStartMuted||(e.startAudioMuted=t,e.startVideoMuted=n,e.getLocalTracks().forEach(t=>{switch(t.getType()){case l.AUDIO:e.startAudioMuted&&t.mute();break;case l.VIDEO:e.startVideoMuted&&t.mute()}}),e.eventEmitter.emit(s.STARTED_MUTED))}),this._addConferenceXMPPListener(y.a.CONFERENCE_TIMESTAMP_RECEIVED,t=>{e.eventEmitter.emit(s.CONFERENCE_CREATED_TIMESTAMP,t)}),this._addConferenceXMPPListener(y.a.AV_MODERATION_CHANGED,(t,n,i)=>{const r=e.getParticipants().find(e=>e.getJid()===i);e.eventEmitter.emit(s.AV_MODERATION_CHANGED,{enabled:t,mediaType:n,actor:r})}),this._addConferenceXMPPListener(y.a.AV_MODERATION_PARTICIPANT_APPROVED,(t,n)=>{const i=e.getParticipantById(r.Strophe.getResourceFromJid(n));i&&e.eventEmitter.emit(s.AV_MODERATION_PARTICIPANT_APPROVED,{participant:i,mediaType:t})}),this._addConferenceXMPPListener(y.a.AV_MODERATION_APPROVED,t=>e.eventEmitter.emit(s.AV_MODERATION_APPROVED,{mediaType:t}))},b.prototype._addConferenceXMPPListener=function(e,t){this.xmppListeners[e]=t,this.conference.xmpp.addListener(e,t)},b.prototype.setupStatisticsListeners=function(){const e=this.conference;e.statistics&&(e.statistics.addAudioLevelListener((t,n,i,r)=>{e.rtc.setAudioLevel(t,n,i,r)}),e.statistics.addBeforeDisposedListener(()=>{e.eventEmitter.emit(s.BEFORE_STATISTICS_DISPOSED)}),e.options.config.startSilent||e.statistics.addByteSentStatsListener((t,n)=>{e.getLocalTracks(l.AUDIO).forEach(e=>{const i=t.getLocalSSRC(e);i&&n.hasOwnProperty(i)&&e._onByteSentStatsReceived(t,n[i])})}))}}).call(this,"src/JitsiConferenceEventManager.js")},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(5),r=n(1),o=n(26),s=n(4);class a{constructor(e,t,n,r,s,a,c){this._jid=e,this._id=i.Strophe.getResourceFromJid(e),this._conference=t,this._displayName=n,this._supportsDTMF=!1,this._tracks=[],this._role="none",this._status=a,this._hidden=r,this._statsID=s,this._connectionStatus=o.ParticipantConnectionStatus.ACTIVE,this._properties={},this._identity=c,this._features=new Set}getConference(){return this._conference}getProperty(e){return this._properties[e]}hasAnyVideoTrackWebRTCMuted(){return this.getTracks().some(e=>e.getType()===s.VIDEO&&e.isWebRTCTrackMuted())}_setConnectionStatus(e){this._connectionStatus=e}getConnectionStatus(){return this._connectionStatus}setProperty(e,t){const n=this._properties[e];t!==n&&(this._properties[e]=t,this._conference.eventEmitter.emit(r.PARTICIPANT_PROPERTY_CHANGED,this,e,n,t))}getTracks(){return this._tracks.slice()}getTracksByMediaType(e){return this.getTracks().filter(t=>t.getType()===e)}getId(){return this._id}getJid(){return this._jid}getDisplayName(){return this._displayName}getStatsID(){return this._statsID}getStatus(){return this._status}isModerator(){return"moderator"===this._role}isHidden(){return this._hidden}isAudioMuted(){return this._isMediaTypeMuted(s.AUDIO)}_isMediaTypeMuted(e){return this.getTracks().reduce((t,n)=>t&&(n.getType()!==e||n.isMuted()),!0)}isVideoMuted(){return this._isMediaTypeMuted(s.VIDEO)}getRole(){return this._role}setRole(e){this._role=e}supportsDTMF(){return this._supportsDTMF}getFeatures(){return Promise.resolve(this._features)}hasFeature(e){return this._features.has(e)}setFeatures(e){this._features=e||new Set}getBotType(){return this._botType}setBotType(e){this._botType=e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(10),r=n(17);function o({id:e,password:t,onCreateResource:n,onLoginSuccessful:o,roomPassword:s}){let a,c=!1,u=new r.d(this.connection.options);const d=new Promise((r,d)=>{a=d,u.addListener(i.CONNECTION_DISCONNECTED,()=>{u=void 0}),u.addListener(i.CONNECTION_ESTABLISHED,()=>{if(c)return;o&&o();u.createRoom(this.options.name,this.options.config,n).moderator.authenticate().then(()=>{u&&u.disconnect(),c||(this.join(s),r())}).catch(({error:e,message:t})=>{u.disconnect(),d({authenticationError:e,message:t})})}),u.addListener(i.CONNECTION_FAILED,(e,t,n)=>{d({connectionError:e,credentials:n,message:t}),u=void 0}),c||u.connect(e,t)});return d.cancel=()=>{c=!0,a({}),u&&u.disconnect()},d}},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t),n.d(t,"ON",(function(){return i})),n.d(t,"OFF",(function(){return r}));const i="on",r="off"},function(e,t,n){"use strict";(function(e){var i=n(15),r=n(34),o=n.n(r);const s=Object(i.getLogger)(e);class a extends o.a{constructor(){super(),this._current={isOnline:!0}}updateNetworkInfo({isOnline:e}){s.debug("updateNetworkInfo",{isOnline:e}),this._current={isOnline:!0===e},this.eventEmitter.emit("NETWORK_INFO_CHANGED",this._current)}isOnline(){return!0===this._current.isOnline}}const c=new a;t.a=c}).call(this,"src/modules/connectivity/NetworkInfo.js")},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){e.exports=n(91).default},function(e,t,n){"use strict";n.r(t),function(e){n(40);var i=n(15),r=n.n(i),o=n(7),s=n(1),a=n(46),c=n(19),u=n(10),d=n(38),h=n(25),l=n(28),p=n(8),f=n(18),m=n(77),_=n(9),g=n.n(_),E=n(13),v=n.n(E),S=n(78),y=n(26),T=n(79),b=n.n(T),C=n(24),A=n(80),N=n.n(A),O=n(81),I=n.n(O),R=n(82),D=n.n(R),P=n(35),L=n.n(P),w=n(83),M=n.n(w),x=n(84),F=n.n(x),j=n(3),k=n.n(j),H=n(85),U=n.n(H),J=n(20),B=n.n(J),V=n(86),G=n.n(V),q=n(36),$=n(87),W=n.n($),K=n(4),X=n(88),z=n(89),Y=n(6),Q=n(27);function Z(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const te=r.a.getLogger(e);function ne(e){const t={audio_requested:e.devices.includes("audio"),video_requested:e.devices.includes("video"),screen_sharing_requested:e.devices.includes("desktop")};return t.video_requested&&(t.resolution=e.resolution),t}t.default=function(e){return"object"==typeof window.SariskaMediaTransport?Object.assign({},window.SariskaMediaTransport,e):e}({version:"{#COMMIT_HASH#}",JitsiConnection:a.a,ProxyConnectionService:I(),constants:{participantConnectionStatus:y.ParticipantConnectionStatus,recording:D.a,sipVideoGW:q,transcriptionStatus:m},events:{conference:s,connection:u,detection:C,track:f,mediaDevices:h,connectionQuality:X,e2eping:z},errors:{conference:o,connection:c,track:p},errorTypes:{JitsiTrackError:l.a},logLevels:r.a.levels,mediaDevices:d.a,analytics:k.a.analytics,init(e={}){e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){ee(e,t,n[t])}))}return e}({},Q.c,e),L.a.init(e.externalStorage),k.a.init(e),window.connectionTimes||(window.connectionTimes={}),!0!==e.enableAnalyticsLogging&&(te.warn("Analytics disabled, disposing."),this.analytics.dispose()),e.enableWindowOnErrorHandler&&B.a.addHandler(this.getGlobalOnErrorHandler.bind(this));const t=e.deploymentInfo;if(t&&Object.keys(t).length>0){const e={};for(const n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.id="deployment_info",k.a.sendLog(JSON.stringify(e))}if(this.version){const e={id:"component_version",component:"sariska-media-transport",version:this.version};k.a.sendLog(JSON.stringify(e))}return g.a.init(e)},isDesktopSharingEnabled:()=>g.a.isDesktopSharingEnabled(),isWebRtcSupported:()=>g.a.isWebRtcSupported(),setLogLevel(e){r.a.setLogLevel(e)},setLogLevelById(e,t){r.a.setLogLevelById(e,t)},addGlobalLogTransport(e){r.a.addGlobalTransport(e)},removeGlobalLogTransport(e){r.a.removeGlobalTransport(e)},setGlobalLogOptions(e){r.a.setGlobalOptions(e)},createLocalTracks(e={},t){let n=!1;const{firePermissionPromptIsShownEvent:i,fireSlowPromiseEvent:r}=e,o=Z(e,["firePermissionPromptIsShownEvent","fireSlowPromiseEvent"]);return(i||t)&&!g.a.arePermissionsGrantedForAvailableDevices()?d.a.emitEvent(h.PERMISSION_PROMPT_IS_SHOWN,v.a.getName()):r&&window.setTimeout(()=>{n||d.a.emitEvent(h.SLOW_GET_USER_MEDIA)},1e3),window.connectionTimes||(window.connectionTimes={}),window.connectionTimes["obtainPermissions.start"]=window.performance.now(),g.a.obtainAudioAndVideoPermissions(o).then(e=>{if(n=!0,window.connectionTimes["obtainPermissions.end"]=window.performance.now(),k.a.sendAnalytics(Object(Y.createGetUserMediaEvent)("success",ne(o))),!g.a.options.disableAudioLevels)for(let t=0;t<e.length;t++){const n=e[t],i=n.getOriginalStream();n.getType()===K.AUDIO&&(k.a.startLocalStats(i,n.setAudioLevel.bind(n)),n.addEventListener(f.LOCAL_TRACK_STOPPED,()=>{k.a.stopLocalStats(i)}))}const t=g.a.getCurrentlyAvailableMediaDevices();if(t)for(let n=0;n<e.length;n++){e[n]._setRealDeviceIdFromDeviceList(t)}for(const t of e)t.type===K.VIDEO&&"desktop"===t.videoType&&this.setVideoTrackContentHints(t.track,"detail");return e}).catch(t=>{if(n=!0,t.name===p.SCREENSHARING_USER_CANCELED){const e={id:"screensharing_user_canceled",message:t.message};k.a.sendLog(JSON.stringify(e)),k.a.sendAnalytics(Object(Y.createGetUserMediaEvent)("warning",{reason:"extension install user canceled"}))}else if(t.name===p.NOT_FOUND){const n={id:"usermedia_missing_device",status:t.gum.devices};k.a.sendLog(JSON.stringify(n));const i=ne(e);i.reason="device not found",i.devices=t.gum.devices.join("."),k.a.sendAnalytics(Object(Y.createGetUserMediaEvent)("error",i))}else{k.a.sendGetUserMediaFailed(t);const n=ne(e);n.reason=t.name,k.a.sendAnalytics(Object(Y.createGetUserMediaEvent)("error",n))}return window.connectionTimes["obtainPermissions.end"]=window.performance.now(),Promise.reject(t)})},createTrackVADEmitter:(e,t,n)=>N.a.create(e,t,n),createAudioMixer:()=>new W.a,getActiveAudioDevice:()=>b()(),isDeviceListAvailable(){return te.warn("This method is deprecated, use SariskaMediaTransport.mediaDevices.isDeviceListAvailable instead"),this.mediaDevices.isDeviceListAvailable()},isDeviceChangeAvailable(e){return te.warn("This method is deprecated, use SariskaMediaTransport.mediaDevices.isDeviceChangeAvailable instead"),this.mediaDevices.isDeviceChangeAvailable(e)},isMultipleAudioInputSupported(){return this.mediaDevices.isMultipleAudioInputSupported()},isCollectingLocalStats:()=>k.a.audioLevelsEnabled&&M.a.isLocalStatsSupported(),enumerateDevices(e){te.warn("This method is deprecated, use SariskaMediaTransport.mediaDevices.enumerateDevices instead"),this.mediaDevices.enumerateDevices(e)},getGlobalOnErrorHandler(e,t,n,i,r){te.error("UnhandledError: "+e,"Script: "+t,"Line: "+n,"Column: "+i,"StackTrace: ",r),k.a.reportGlobalError(r)},setNetworkInfo({isOnline:e}){S.a.updateNetworkInfo({isOnline:e})},setVideoTrackContentHints(e,t){"contentHint"in e?(e.contentHint=t,e.contentHint!==t&&te.debug("Invalid video track contentHint")):te.debug("MediaStreamTrack contentHint attribute not supported")},precallTest:F(),util:{AuthUtil:U(),ScriptUtil:G(),browser:v()}})}.call(this,"src/SariskaMediaTransport.js")},function(e,t,n){"use strict";(function(e){var t=n(0);(e=>{void 0===e.$&&(e.$=t.a)})(e||window||void 0)}).call(this,n(39))},function(e,t,n){var i=n(45);function r(e,t){this.logStorage=e,this.stringifyObjects=!(!t||!t.stringifyObjects)&&t.stringifyObjects,this.storeInterval=t&&t.storeInterval?t.storeInterval:3e4,this.maxEntryLength=t&&t.maxEntryLength?t.maxEntryLength:1e4,Object.keys(i.levels).forEach(function(e){this[i.levels[e]]=function(){this._log.apply(this,arguments)}.bind(this,e)}.bind(this)),this.storeLogsIntervalID=null,this.queue=[],this.totalLen=0,this.outputCache=[]}r.prototype.stringify=function(e){try{return JSON.stringify(e)}catch(e){return"[object with circular refs?]"}},r.prototype.formatLogMessage=function(e){for(var t="",n=1,r=arguments.length;n<r;n++){var o=arguments[n];!this.stringifyObjects&&e!==i.levels.ERROR||"object"!=typeof o||(o=this.stringify(o)),t+=o,n!==r-1&&(t+=" ")}return t.length?t:null},r.prototype._log=function(){var e=arguments[1],t=this.formatLogMessage.apply(this,arguments);if(t){var n=this.queue[this.queue.length-1],i=n&&n.text;i===t?n.count+=1:(this.queue.push({text:t,timestamp:e,count:1}),this.totalLen+=t.length)}this.totalLen>=this.maxEntryLength&&this._flush(!0,!0)},r.prototype.start=function(){this._reschedulePublishInterval()},r.prototype._reschedulePublishInterval=function(){this.storeLogsIntervalID&&(window.clearTimeout(this.storeLogsIntervalID),this.storeLogsIntervalID=null),this.storeLogsIntervalID=window.setTimeout(this._flush.bind(this,!1,!0),this.storeInterval)},r.prototype.flush=function(){this._flush(!1,!0)},r.prototype._flush=function(e,t){this.totalLen>0&&(this.logStorage.isReady()||e)&&(this.logStorage.isReady()?(this.outputCache.length&&(this.outputCache.forEach(function(e){this.logStorage.storeLogs(e)}.bind(this)),this.outputCache=[]),this.logStorage.storeLogs(this.queue)):this.outputCache.push(this.queue),this.queue=[],this.totalLen=0),t&&this._reschedulePublishInterval()},r.prototype.stop=function(){this._flush(!1,!1)},e.exports=r},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){!function(e){"use strict";e.Strophe.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(t){this._connection=t,this._identities=[],this._features=[],this._items=[],t.addHandler(this._onDiscoInfo.bind(this),e.Strophe.NS.DISCO_INFO,"iq","get",null,null),t.addHandler(this._onDiscoItems.bind(this),e.Strophe.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(e,t,n,i){for(var r=0;r<this._identities.length;r++)if(this._identities[r].category==e&&this._identities[r].type==t&&this._identities[r].name==n&&this._identities[r].lang==i)return!1;return this._identities.push({category:e,type:t,name:n,lang:i}),!0},addFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]==e)return!1;return this._features.push(e),!0},removeFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]===e)return this._features.splice(t,1),!0;return!1},addItem:function(e,t,n,i){return!(n&&!i||(this._items.push({jid:e,name:t,node:n,call_back:i}),0))},info:function(t,n,i,r,o){var s={xmlns:e.Strophe.NS.DISCO_INFO};n&&(s.node=n);var a=e.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",s);this._connection.sendIQ(a,i,r,o)},items:function(t,n,i,r,o){var s={xmlns:e.Strophe.NS.DISCO_ITEMS};n&&(s.node=n);var a=e.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",s);this._connection.sendIQ(a,i,r,o)},_buildIQResult:function(t,n){var i=t.getAttribute("id"),r=t.getAttribute("from"),o=e.$iq({type:"result",id:i});return null!==r&&o.attrs({to:r}),o.c("query",n)},_onDiscoInfo:function(t){var n,i=t.getElementsByTagName("query")[0].getAttribute("node"),r={xmlns:e.Strophe.NS.DISCO_INFO};i&&(r.node=i);var o=this._buildIQResult(t,r);for(n=0;n<this._identities.length;n++)r={category:this._identities[n].category,type:this._identities[n].type},this._identities[n].name&&(r.name=this._identities[n].name),this._identities[n].lang&&(r["xml:lang"]=this._identities[n].lang),o.c("identity",r).up();for(n=0;n<this._features.length;n++)o.c("feature",{var:this._features[n]}).up();return this._connection.send(o.tree()),!0},_onDiscoItems:function(t){var n,i,r={xmlns:e.Strophe.NS.DISCO_ITEMS},o=t.getElementsByTagName("query")[0].getAttribute("node");if(o){for(r.node=o,n=[],i=0;i<this._items.length;i++)if(this._items[i].node==o){n=this._items[i].call_back(t);break}}else n=this._items;var s=this._buildIQResult(t,r);for(i=0;i<n.length;i++){var a={jid:n[i].jid};n[i].name&&(a.name=n[i].name),n[i].node&&(a.node=n[i].node),s.c("item",a).up()}return this._connection.send(s.tree()),!0}})}(n(5))}])}));
//# sourceMappingURL=sariska-media-transport.min.map